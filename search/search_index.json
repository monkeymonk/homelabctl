{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"homelabctl","text":"<ul> <li> <p> Simple &amp; Powerful</p> <p>No complex orchestration platforms. Just Docker Compose with declarative configuration.</p> </li> <li> <p> Secure by Default</p> <p>Built-in SOPS encryption for secrets. Keep sensitive data safe.</p> </li> <li> <p> Reproducible</p> <p>Version control your entire homelab. Same input = same output, always.</p> </li> <li> <p> Flexible Templates</p> <p>Powerful templating with gomplate. Customize everything.</p> </li> </ul>"},{"location":"#what-is-homelabctl","title":"What is homelabctl?","text":"<p>homelabctl is a CLI tool for managing Docker stacks in your homelab using declarative, template-based configuration.</p> <p>Think of it as a compiler for your homelab: it transforms static stack definitions into runtime Docker Compose configurations.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>\u2705 Declarative Configuration - Infrastructure as code for your homelab</li> <li>\u2705 Template-Based - Powered by gomplate for flexible templates</li> <li>\u2705 Dependency Management - Automatic validation of stack dependencies</li> <li>\u2705 Secrets Support - Automatic SOPS decryption for encrypted secrets</li> <li>\u2705 Category System - Organize stacks with automatic deployment ordering</li> <li>\u2705 Service-Level Control - Disable individual services without disabling stacks</li> <li>\u2705 Docker Compose Passthrough - Full access to all docker compose commands</li> <li>\u2705 Fail-Fast - Clear errors with actionable suggestions</li> </ul>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code># Initialize your homelab\nmkdir ~/homelab &amp;&amp; cd ~/homelab\nhomelabctl init\n\n# Configure your domain\necho \"domain: homelab.local\" &gt; inventory/vars.yaml\n\n# Enable and deploy a stack\nhomelabctl enable traefik\nhomelabctl deploy\n\n# Check status\nhomelabctl ps\n</code></pre> <p>That's it! Your first service is running.</p>"},{"location":"#architecture-overview","title":"Architecture Overview","text":"<pre><code>graph LR\n    A[Stack Definitions] --&gt; B[homelabctl generate]\n    C[Inventory Vars] --&gt; B\n    D[Secrets] --&gt; B\n    B --&gt; E[docker-compose.yml]\n    E --&gt; F[docker compose up]\n</code></pre> <p>homelabctl acts as a compiler:</p> <ol> <li>Input: Stack definitions + inventory + secrets</li> <li>Process: Template rendering + variable merging + validation</li> <li>Output: Single <code>docker-compose.yml</code> file</li> <li>Deploy: Standard Docker Compose commands</li> </ol>"},{"location":"#why-homelabctl","title":"Why homelabctl?","text":""},{"location":"#for-homelabbers","title":"For Homelabbers","text":"<ul> <li>\ud83c\udfe0 Perfect for single-node home servers</li> <li>\ud83d\udce6 Simpler than Kubernetes, more powerful than plain Docker Compose</li> <li>\ud83d\udd04 Reproducible infrastructure - backup your config, restore anywhere</li> <li>\ud83c\udfaf Declarative - define what you want, not how to get there</li> </ul>"},{"location":"#for-developers","title":"For Developers","text":"<ul> <li>\ud83e\uddea Test entire stacks locally before deployment</li> <li>\ud83d\udcdd Version control everything</li> <li>\ud83d\udd10 Secrets management built-in</li> <li>\ud83d\udee0\ufe0f Extensible architecture</li> </ul>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li> <p> Installation</p> <p>Install homelabctl on your system</p> </li> <li> <p> Quick Start</p> <p>Get up and running in 5 minutes</p> </li> <li> <p> User Guide</p> <p>Learn all the features and commands</p> </li> <li> <p> Contributing</p> <p>Help improve homelabctl</p> </li> </ul>"},{"location":"#community","title":"Community","text":"<ul> <li>GitHub Discussions - Ask questions and share ideas</li> <li>GitHub Issues - Report bugs or request features</li> <li>Contributing Guide - Help improve the project</li> </ul> <p>Star the project</p> <p>If you find homelabctl useful, consider \u2b50 starring it on GitHub!</p>"},{"location":"SETUP/","title":"GitHub Pages Setup Instructions","text":""},{"location":"SETUP/#enabling-github-pages","title":"Enabling GitHub Pages","text":"<ol> <li>Push the documentation to GitHub:</li> </ol> <pre><code>git add docs/ mkdocs.yml requirements.txt .github/workflows/docs.yml\ngit commit -m \"docs: add GitHub Pages documentation site\"\ngit push origin main\n</code></pre> <ol> <li> <p>Enable GitHub Pages in repository settings:</p> </li> <li> <p>Go to your repository on GitHub</p> </li> <li>Navigate to Settings \u2192 Pages</li> <li>Under Source, select Deploy from a branch</li> <li>Select branch: gh-pages</li> <li> <p>Click Save</p> </li> <li> <p>Wait for deployment:</p> </li> <li> <p>The GitHub Action will automatically build and deploy</p> </li> <li>Check the Actions tab to monitor progress</li> <li>Site will be available at: <code>https://monkeymonk.github.io/homelabctl/</code></li> </ol>"},{"location":"SETUP/#local-development","title":"Local Development","text":""},{"location":"SETUP/#first-time-setup","title":"First Time Setup","text":"<pre><code># Install dependencies\npip install -r requirements.txt\n</code></pre>"},{"location":"SETUP/#serve-locally","title":"Serve Locally","text":"<pre><code># Start development server\nmkdocs serve\n\n# Visit http://localhost:8000\n</code></pre>"},{"location":"SETUP/#build-static-site","title":"Build Static Site","text":"<pre><code># Build to site/ directory\nmkdocs build\n\n# Preview the built site\ncd site &amp;&amp; python -m http.server 8000\n</code></pre>"},{"location":"SETUP/#adding-new-pages","title":"Adding New Pages","text":"<ol> <li>Create markdown file in <code>docs/</code></li> <li>Add to navigation in <code>mkdocs.yml</code></li> <li>Commit and push (auto-deploys)</li> </ol>"},{"location":"SETUP/#customization","title":"Customization","text":"<p>Edit <code>mkdocs.yml</code> to customize:</p> <ul> <li>Site name and description</li> <li>Theme colors</li> <li>Navigation structure</li> <li>Plugins and extensions</li> </ul>"},{"location":"SETUP/#troubleshooting","title":"Troubleshooting","text":""},{"location":"SETUP/#build-fails","title":"Build Fails","text":"<p>Check the GitHub Actions logs for errors. Common issues:</p> <ul> <li>Missing dependencies in <code>requirements.txt</code></li> <li>Invalid markdown syntax</li> <li>Broken internal links</li> </ul>"},{"location":"SETUP/#site-not-updating","title":"Site Not Updating","text":"<ul> <li>Ensure workflow ran successfully (check Actions tab)</li> <li>Clear browser cache</li> <li>Check that gh-pages branch exists</li> </ul>"},{"location":"SETUP/#resources","title":"Resources","text":"<ul> <li>MkDocs Documentation</li> <li>Material for MkDocs</li> <li>GitHub Pages Docs</li> </ul>"},{"location":"advanced/architecture/","title":"Architecture","text":"<p>homelabctl is designed as a compiler that transforms declarative stack definitions into runtime Docker Compose files. This document explains the design philosophy and code structure.</p>"},{"location":"advanced/architecture/#core-philosophy","title":"Core Philosophy","text":""},{"location":"advanced/architecture/#1-deterministic","title":"1. Deterministic","text":"<p>Same input always produces same output:</p> <pre><code># Same stacks + same inventory + same secrets = identical output\nhomelabctl generate  # Run 1\nhomelabctl generate  # Run 2 \u2192 Identical docker-compose.yml\n</code></pre> <p>No timestamps, random values, or state-dependent behavior.</p>"},{"location":"advanced/architecture/#2-fail-fast","title":"2. Fail-Fast","text":"<p>Loud errors, no silent recovery:</p> <pre><code>if err != nil {\n    return err  // Exit code 1\n}\n</code></pre> <p>Never: - Silently skip errors - Provide default fallbacks for missing data - Continue on failure</p> <p>Always: - Return errors immediately - Exit with code 1 on any error - Print actionable error messages</p>"},{"location":"advanced/architecture/#3-no-magic","title":"3. No Magic","text":"<p>All behavior is explicit and traceable:</p> <ul> <li>No auto-discovery of undefined behavior</li> <li>No implicit configuration</li> <li>No hidden state</li> <li>Everything is defined in YAML or code</li> </ul>"},{"location":"advanced/architecture/#4-compiler-style","title":"4. Compiler-Style","text":"<p>Static input \u2192 generated output:</p> <pre><code>stacks/ + inventory/ + secrets/ \u2192 runtime/docker-compose.yml\n   \u2193          \u2193          \u2193              \u2191\n (static)  (static)  (static)      (generated)\n</code></pre> <p>No runtime state, no database, no API calls (except to Docker).</p>"},{"location":"advanced/architecture/#5-filesystem-is-source-of-truth","title":"5. Filesystem is Source of Truth","text":"<p>Enabled services represented by symlinks:</p> <pre><code>enabled/\n\u251c\u2500\u2500 traefik -&gt; ../stacks/traefik\n\u2514\u2500\u2500 authentik -&gt; ../stacks/authentik\n</code></pre> <p>Not variables, not config files, not state.</p>"},{"location":"advanced/architecture/#code-structure","title":"Code Structure","text":"<pre><code>main.go           # Entry point - simple switch/case\ncmd/              # Command implementations (orchestration only)\ninternal/         # All business logic\n</code></pre>"},{"location":"advanced/architecture/#design-decisions","title":"Design Decisions","text":"<p>1. No CLI Framework</p> <pre><code>// main.go\nswitch command {\ncase \"init\":\n    return cmd.Init()\ncase \"enable\":\n    return cmd.Enable(args)\n// ...\n}\n</code></pre> <p>Why: Simple, auditable, no magic. No hidden flags, no auto-generated help text that diverges from docs.</p> <p>2. Gomplate as External Binary</p> <pre><code>// internal/render/render.go\ncmd := exec.Command(\"gomplate\", \"-f\", template, \"-c\", context)\n</code></pre> <p>Why: - Don't reinvent templating - Gomplate is battle-tested - Users can test templates standalone - Clear separation of concerns</p> <p>3. Temporary Compose Files</p> <pre><code>runtime/\n\u251c\u2500\u2500 traefik-compose.yml      # Temporary\n\u251c\u2500\u2500 authentik-compose.yml    # Temporary\n\u2514\u2500\u2500 docker-compose.yml       # Final merged output\n</code></pre> <p>Why: - Each stack renders independently - Easy to debug individual stacks - Parallel rendering possible (future) - Clean separation before merging</p> <p>4. Secrets are Optional</p> <pre><code>// Secrets may or may not exist - that's OK\nsecrets, err := secrets.Load(stackName)\nif err != nil &amp;&amp; !os.IsNotExist(err) {\n    return err  // Only fail on read errors, not missing files\n}\n</code></pre> <p>Why: Stacks should work without secrets for development/testing.</p> <p>5. Pipeline Pattern</p> <pre><code>p := pipeline.New()\np.AddStage(LoadStacks())\np.AddStage(LoadInventory())\np.AddStage(RenderTemplates())\n// ...\nreturn p.Execute()\n</code></pre> <p>Why: See Pipeline Details for full explanation.</p> <p>6. Docker Compose Passthrough</p> <pre><code>// main.go\ndefault:\n    // Unknown command \u2192 pass to docker compose\n    return cmd.ComposePassthrough(os.Args[1:])\n</code></pre> <p>Why: homelabctl acts as complete Docker Compose wrapper.</p>"},{"location":"advanced/architecture/#module-organization","title":"Module Organization","text":""},{"location":"advanced/architecture/#cmd-command-orchestration","title":"cmd/ - Command Orchestration","text":"<p>Responsibilities: - Parse command-line arguments - Call internal packages in correct order - Handle errors and output - NO business logic</p> <p>Example: <pre><code>func Enable(args []string) error {\n    stackName := args[0]\n\n    if err := fs.VerifyRepository(); err != nil {\n        return err\n    }\n\n    return fs.CreateSymlink(stackName)\n}\n</code></pre></p>"},{"location":"advanced/architecture/#internal-business-logic","title":"internal/ - Business Logic","text":"<p>All implementation details:</p>"},{"location":"advanced/architecture/#internalfs-filesystem-operations","title":"internal/fs - Filesystem Operations","text":"<pre><code>// Verify repository structure\nfs.VerifyRepository()\n\n// Manage symlinks\nfs.CreateSymlink(stackName)\nfs.RemoveSymlink(stackName)\nfs.ListEnabled()\n</code></pre>"},{"location":"advanced/architecture/#internalstacks-stack-management","title":"internal/stacks - Stack Management","text":"<pre><code>// Load stack definitions\nstack, err := stacks.Load(stackName)\n\n// Validate dependencies\nerr := stacks.ValidateDependencies(enabled)\n\n// Detect cycles\ncycle, err := stacks.DetectCycles(enabled)\n</code></pre>"},{"location":"advanced/architecture/#internalcategories-category-system","title":"internal/categories - Category System","text":"<pre><code>// Register category (dynamic discovery)\ncategories.RegisterCategory(categoryName)\n\n// Get category metadata\nmeta := categories.Get(categoryName)\n\n// Validate dependencies based on order\nerr := categories.ValidateDependencies(stacks)\n</code></pre>"},{"location":"advanced/architecture/#internalinventory-global-configuration","title":"internal/inventory - Global Configuration","text":"<pre><code>// Load inventory vars\nvars, err := inventory.Load()\n\n// Access variables\ndomain := vars.Get(\"domain\")\n</code></pre>"},{"location":"advanced/architecture/#internalsecrets-secret-management","title":"internal/secrets - Secret Management","text":"<pre><code>// Load secrets (SOPS integration)\nsecrets, err := secrets.Load(stackName)\n\n// Automatically detects .enc.yaml and decrypts\n</code></pre>"},{"location":"advanced/architecture/#internalrender-template-rendering","title":"internal/render - Template Rendering","text":"<pre><code>// Render template with gomplate\noutput, err := render.Template(templatePath, context)\n\n// Context structure:\n// .vars   - merged variables\n// .stack  - stack metadata\n// .stacks - global info\n</code></pre>"},{"location":"advanced/architecture/#internalcompose-compose-file-merging","title":"internal/compose - Compose File Merging","text":"<pre><code>// Merge multiple compose files\nmerged, err := compose.Merge(files...)\n\n// Services: must be unique (error on duplicate)\n// Volumes: can duplicate (silent skip)\n// Networks: can duplicate (silent skip)\n</code></pre>"},{"location":"advanced/architecture/#internalpipeline-pipeline-pattern","title":"internal/pipeline - Pipeline Pattern","text":"<pre><code>// Create pipeline\np := pipeline.New()\n\n// Add stages\np.AddStage(stage1)\np.AddStage(stage2)\n\n// Execute (stops on first error)\nerr := p.Execute()\n</code></pre>"},{"location":"advanced/architecture/#internalerrors-enhanced-errors","title":"internal/errors - Enhanced Errors","text":"<pre><code>// Create error with suggestions\nreturn errors.New(\n    \"stack 'foo' does not exist\",\n    \"Run: homelabctl list\",\n    \"Check stacks/ directory\",\n)\n\n// Wrap existing error\nreturn errors.Wrap(err,\n    \"failed to load stack\",\n    \"Check stack.yaml syntax\",\n)\n</code></pre>"},{"location":"advanced/architecture/#internalpaths-path-resolution","title":"internal/paths - Path Resolution","text":"<pre><code>// Get repository root\nroot := paths.Root()\n\n// Build path relative to root\nstackPath := paths.Stack(stackName)\n</code></pre>"},{"location":"advanced/architecture/#data-flow","title":"Data Flow","text":""},{"location":"advanced/architecture/#generate-command-simplified","title":"Generate Command (Simplified)","text":"<pre><code>1. VerifyRepository()\n   \u2193\n2. ListEnabled() \u2192 [traefik, authentik]\n   \u2193\n3. ValidateDependencies([traefik, authentik])\n   \u2193\n4. LoadInventory() \u2192 vars.yaml\n   \u2193\n5. For each stack:\n   a. LoadStack(name) \u2192 stack.yaml\n   b. LoadSecrets(name) \u2192 secrets/name.enc.yaml\n   c. MergeVars(stack, inventory, secrets)\n   d. BuildContext(.vars, .stack, .stacks)\n   e. RenderTemplate(compose.yml.tmpl, context)\n   \u2193\n6. FilterServices(disabled_services)\n   \u2193\n7. MergeCompose([...compose files])\n   \u2193\n8. WriteOutput(docker-compose.yml)\n   \u2193\n9. Cleanup(temp files)\n</code></pre> <p>See Pipeline Details for full implementation.</p>"},{"location":"advanced/architecture/#error-handling","title":"Error Handling","text":""},{"location":"advanced/architecture/#principle-fail-fast","title":"Principle: Fail Fast","text":"<pre><code>if err != nil {\n    return err  // Immediately propagate\n}\n</code></pre>"},{"location":"advanced/architecture/#actionable-errors","title":"Actionable Errors","text":"<p>Use enhanced errors for clarity:</p> <pre><code>// Bad\nreturn fmt.Errorf(\"file not found\")\n\n// Good\nreturn errors.FileNotFound(path,\n    \"Initialize repository with: homelabctl init\",\n)\n</code></pre>"},{"location":"advanced/architecture/#error-propagation","title":"Error Propagation","text":"<pre><code>// cmd/ returns errors to main()\nfunc Generate() error {\n    if err := verifyRepo(); err != nil {\n        return err\n    }\n    // ...\n}\n\n// main() handles output and exit\nfunc main() {\n    if err := run(); err != nil {\n        fmt.Fprintf(os.Stderr, \"Error: %v\\n\", err)\n        os.Exit(1)\n    }\n}\n</code></pre>"},{"location":"advanced/architecture/#testing-strategy","title":"Testing Strategy","text":""},{"location":"advanced/architecture/#unit-tests","title":"Unit Tests","text":"<p>Test individual functions in isolation:</p> <pre><code>// internal/stacks/stacks_test.go\nfunc TestValidateDependencies(t *testing.T) {\n    // Test dependency validation logic\n}\n</code></pre>"},{"location":"advanced/architecture/#integration-tests","title":"Integration Tests","text":"<p>Test full workflows:</p> <pre><code>// cmd/integration_test.go\nfunc TestGenerateWorkflow(t *testing.T) {\n    // Test: init \u2192 enable \u2192 generate\n}\n</code></pre>"},{"location":"advanced/architecture/#test-patterns","title":"Test Patterns","text":"<p>Table-Driven Tests: <pre><code>tests := []struct {\n    name    string\n    input   string\n    wantErr bool\n}{\n    {\"valid\", \"traefik\", false},\n    {\"invalid\", \"missing\", true},\n}\n</code></pre></p> <p>Temporary Directories: <pre><code>tmpDir := t.TempDir()\nos.Chdir(tmpDir)\n// Test runs in isolation\n</code></pre></p>"},{"location":"advanced/architecture/#performance-considerations","title":"Performance Considerations","text":""},{"location":"advanced/architecture/#current-serial-processing","title":"Current: Serial Processing","text":"<p>Stacks processed one at a time:</p> <pre><code>for _, stack := range enabled {\n    if err := renderStack(stack); err != nil {\n        return err\n    }\n}\n</code></pre> <p>Why: Simpler to implement and debug.</p>"},{"location":"advanced/architecture/#future-parallel-processing","title":"Future: Parallel Processing","text":"<p>Independent stacks can render in parallel:</p> <pre><code>// Future optimization\nvar wg sync.WaitGroup\nfor _, stack := range enabled {\n    wg.Add(1)\n    go func(s string) {\n        defer wg.Done()\n        renderStack(s)\n    }(stack)\n}\nwg.Wait()\n</code></pre> <p>Tradeoffs: - Faster for many stacks - More complex error handling - Harder to debug</p>"},{"location":"advanced/architecture/#extension-points","title":"Extension Points","text":""},{"location":"advanced/architecture/#adding-new-commands","title":"Adding New Commands","text":"<ol> <li>Add command handler in <code>cmd/</code>:</li> </ol> <pre><code>// cmd/mycommand.go\nfunc MyCommand(args []string) error {\n    // Implementation\n}\n</code></pre> <ol> <li>Add to switch in <code>main.go</code>:</li> </ol> <pre><code>case \"mycommand\":\n    return cmd.MyCommand(args[1:])\n</code></pre>"},{"location":"advanced/architecture/#adding-pipeline-stages","title":"Adding Pipeline Stages","text":"<p>See Pipeline Details</p>"},{"location":"advanced/architecture/#adding-secret-backends","title":"Adding Secret Backends","text":"<p>See Extension Points</p>"},{"location":"advanced/architecture/#see-also","title":"See Also","text":"<ul> <li>Pipeline Details - Generation pipeline architecture</li> <li>Extension Points - How to extend homelabctl</li> <li>Contributing - Development setup</li> </ul>"},{"location":"advanced/extensions/","title":"Extension Points","text":"<p>homelabctl is designed to be extensible. This document describes the primary extension points and how to add new functionality.</p>"},{"location":"advanced/extensions/#overview","title":"Overview","text":"<p>homelabctl can be extended in several ways:</p> <ol> <li>SOPS Integration - Add secret backends</li> <li>Contribute Patterns - Add cross-stack contributions (Nginx, etc.)</li> <li>Validation Rules - Add custom validation logic</li> <li>Pipeline Stages - Add processing stages</li> <li>Commands - Add new CLI commands</li> </ol>"},{"location":"advanced/extensions/#1-sops-integration","title":"1. SOPS Integration","text":""},{"location":"advanced/extensions/#current-implementation","title":"Current Implementation","text":"<p>Location: <code>internal/secrets/secrets.go</code></p> <pre><code>func Load(stackName string) (map[string]interface{}, error) {\n    // Try encrypted file first\n    encPath := path.Join(\"secrets\", stackName+\".enc.yaml\")\n    if fileExists(encPath) {\n        return decryptSOPS(encPath)\n    }\n\n    // Fall back to plain YAML\n    plainPath := path.Join(\"secrets\", stackName+\".yaml\")\n    if fileExists(plainPath) {\n        return loadPlainYAML(plainPath)\n    }\n\n    return nil, os.ErrNotExist\n}\n\nfunc decryptSOPS(path string) (map[string]interface{}, error) {\n    cmd := exec.Command(\"sops\", \"-d\", path)\n    output, err := cmd.Output()\n    if err != nil {\n        return nil, err\n    }\n\n    var data map[string]interface{}\n    if err := yaml.Unmarshal(output, &amp;data); err != nil {\n        return nil, err\n    }\n\n    return data, nil\n}\n</code></pre>"},{"location":"advanced/extensions/#adding-alternative-backend","title":"Adding Alternative Backend","text":"<p>To support a different secret backend (e.g., Vault, AWS Secrets Manager):</p> <pre><code>// internal/secrets/vault.go\nfunc loadFromVault(stackName string) (map[string]interface{}, error) {\n    client, err := vault.NewClient(&amp;vault.Config{\n        Address: os.Getenv(\"VAULT_ADDR\"),\n    })\n    if err != nil {\n        return nil, err\n    }\n\n    secret, err := client.Logical().Read(fmt.Sprintf(\"secret/homelabctl/%s\", stackName))\n    if err != nil {\n        return nil, err\n    }\n\n    return secret.Data, nil\n}\n\n// Update Load() to try multiple backends\nfunc Load(stackName string) (map[string]interface{}, error) {\n    // Try SOPS first\n    if data, err := loadSOPS(stackName); err == nil {\n        return data, nil\n    }\n\n    // Try Vault\n    if vaultEnabled() {\n        if data, err := loadFromVault(stackName); err == nil {\n            return data, nil\n        }\n    }\n\n    // Fall back to plain YAML\n    return loadPlainYAML(stackName)\n}\n</code></pre>"},{"location":"advanced/extensions/#configuration","title":"Configuration","text":"<p>Add backend configuration to <code>inventory/vars.yaml</code>:</p> <pre><code>secrets:\n  backend: vault  # or \"sops\", \"aws-secretsmanager\"\n  vault:\n    address: https://vault.example.com\n    path_prefix: homelabctl\n</code></pre>"},{"location":"advanced/extensions/#2-contribute-patterns","title":"2. Contribute Patterns","text":""},{"location":"advanced/extensions/#current-implementation_1","title":"Current Implementation","text":"<p>Location: <code>cmd/generate.go</code> (around line 100)</p> <pre><code>// Handle Traefik contributions\ntraefikDir := filepath.Join(\"runtime\", \"traefik\", \"dynamic\")\nif err := os.MkdirAll(traefikDir, 0755); err != nil {\n    return err\n}\n\nfor _, stackName := range enabledStacks {\n    contributePath := filepath.Join(\"stacks\", stackName, \"contribute\", \"traefik\")\n    if !dirExists(contributePath) {\n        continue\n    }\n\n    // Render Traefik contribution templates\n    templates, _ := filepath.Glob(filepath.Join(contributePath, \"*.tmpl\"))\n    for _, tmpl := range templates {\n        outputName := strings.TrimSuffix(filepath.Base(tmpl), \".tmpl\")\n        outputPath := filepath.Join(traefikDir, stackName+\"-\"+outputName)\n\n        if err := render.Template(tmpl, context, outputPath); err != nil {\n            return err\n        }\n    }\n}\n</code></pre>"},{"location":"advanced/extensions/#adding-nginx-contributions","title":"Adding Nginx Contributions","text":"<pre><code>// internal/pipeline/contributions.go\nfunc RenderContributions() Stage {\n    return func(ctx *Context) error {\n        // Define contribution handlers\n        handlers := map[string]ContributionHandler{\n            \"traefik\": renderTraefikContributions,\n            \"nginx\":   renderNginxContributions,\n            \"caddy\":   renderCaddyContributions,\n        }\n\n        for provider, handler := range handlers {\n            if err := handler(ctx, provider); err != nil {\n                return err\n            }\n        }\n\n        return nil\n    }\n}\n\ntype ContributionHandler func(*Context, string) error\n\nfunc renderNginxContributions(ctx *Context, provider string) error {\n    outputDir := filepath.Join(\"runtime\", \"nginx\", \"conf.d\")\n    if err := os.MkdirAll(outputDir, 0755); err != nil {\n        return err\n    }\n\n    for _, stackName := range ctx.EnabledStacks {\n        contributePath := filepath.Join(\"stacks\", stackName, \"contribute\", provider)\n        if !dirExists(contributePath) {\n            continue\n        }\n\n        templates, _ := filepath.Glob(filepath.Join(contributePath, \"*.tmpl\"))\n        for _, tmpl := range templates {\n            outputName := strings.TrimSuffix(filepath.Base(tmpl), \".tmpl\")\n            outputPath := filepath.Join(outputDir, stackName+\"-\"+outputName)\n\n            config := ctx.StackConfigs[stackName]\n            templateCtx := buildTemplateContext(stackName, config, ctx)\n\n            if err := render.Template(tmpl, templateCtx, outputPath); err != nil {\n                return err\n            }\n        }\n    }\n\n    return nil\n}\n</code></pre>"},{"location":"advanced/extensions/#usage-in-stacks","title":"Usage in Stacks","text":"<pre><code>stacks/myapp/\n\u251c\u2500\u2500 stack.yaml\n\u251c\u2500\u2500 compose.yml.tmpl\n\u2514\u2500\u2500 contribute/\n    \u251c\u2500\u2500 traefik/\n    \u2502   \u2514\u2500\u2500 routes.yml.tmpl\n    \u251c\u2500\u2500 nginx/\n    \u2502   \u2514\u2500\u2500 server.conf.tmpl\n    \u2514\u2500\u2500 caddy/\n        \u2514\u2500\u2500 site.caddy.tmpl\n</code></pre>"},{"location":"advanced/extensions/#3-validation-rules","title":"3. Validation Rules","text":""},{"location":"advanced/extensions/#current-implementation_2","title":"Current Implementation","text":"<p>Location: <code>cmd/validate.go</code></p> <pre><code>func Validate() error {\n    // Verify repository\n    if err := fs.VerifyRepository(); err != nil {\n        return err\n    }\n\n    // Load enabled stacks\n    enabled, err := fs.ListEnabled()\n    if err != nil {\n        return err\n    }\n\n    // Validate dependencies\n    if err := stacks.ValidateDependencies(enabled); err != nil {\n        return err\n    }\n\n    fmt.Println(\"\u2713 All validations passed\")\n    return nil\n}\n</code></pre>"},{"location":"advanced/extensions/#adding-custom-validation","title":"Adding Custom Validation","text":"<pre><code>// internal/validation/rules.go\ntype Rule interface {\n    Name() string\n    Validate(*Context) error\n}\n\ntype MandatoryStacksRule struct {\n    Required []string\n}\n\nfunc (r *MandatoryStacksRule) Name() string {\n    return \"mandatory-stacks\"\n}\n\nfunc (r *MandatoryStacksRule) Validate(ctx *Context) error {\n    enabled := make(map[string]bool)\n    for _, stack := range ctx.EnabledStacks {\n        enabled[stack] = true\n    }\n\n    var missing []string\n    for _, required := range r.Required {\n        if !enabled[required] {\n            missing = append(missing, required)\n        }\n    }\n\n    if len(missing) &gt; 0 {\n        return fmt.Errorf(\"missing mandatory stacks: %v\", missing)\n    }\n\n    return nil\n}\n\n// Add to validation\nfunc Validate() error {\n    ctx := &amp;Context{}\n    // ... load context ...\n\n    rules := []Rule{\n        &amp;MandatoryStacksRule{Required: []string{\"traefik\"}},\n        &amp;SecretsRequiredRule{Stacks: []string{\"authentik\"}},\n        &amp;CategoryOrderRule{},\n    }\n\n    for _, rule := range rules {\n        if err := rule.Validate(ctx); err != nil {\n            return fmt.Errorf(\"%s validation failed: %w\", rule.Name(), err)\n        }\n    }\n\n    return nil\n}\n</code></pre>"},{"location":"advanced/extensions/#configuration_1","title":"Configuration","text":"<pre><code># inventory/vars.yaml\nvalidation:\n  mandatory_stacks:\n    - traefik\n    - authentik\n  require_secrets:\n    - authentik\n    - nextcloud\n  max_stacks: 50\n</code></pre>"},{"location":"advanced/extensions/#4-pipeline-stages","title":"4. Pipeline Stages","text":"<p>See Pipeline Details for comprehensive guide.</p>"},{"location":"advanced/extensions/#quick-example","title":"Quick Example","text":"<pre><code>// internal/pipeline/stages.go\nfunc BackupStage() Stage {\n    return func(ctx *Context) error {\n        backupDir := filepath.Join(\"runtime\", \"backups\")\n        timestamp := time.Now().Format(\"20060102-150405\")\n\n        // Backup previous compose file\n        if fileExists(\"runtime/docker-compose.yml\") {\n            backupPath := filepath.Join(backupDir, fmt.Sprintf(\"docker-compose-%s.yml\", timestamp))\n            if err := copyFile(\"runtime/docker-compose.yml\", backupPath); err != nil {\n                return err\n            }\n        }\n\n        return nil\n    }\n}\n\n// Add to pipeline in cmd/generate.go\np.AddStage(pipeline.BackupStage())\np.AddStage(pipeline.RenderTemplates())\n// ...\n</code></pre>"},{"location":"advanced/extensions/#5-new-commands","title":"5. New Commands","text":""},{"location":"advanced/extensions/#1-create-command-handler","title":"1. Create Command Handler","text":"<pre><code>// cmd/backup.go\npackage cmd\n\nimport (\n    \"fmt\"\n    \"github.com/monkeymonk/homelabctl/internal/fs\"\n)\n\nfunc Backup(args []string) error {\n    if err := fs.VerifyRepository(); err != nil {\n        return err\n    }\n\n    // Implementation\n    fmt.Println(\"Creating backup...\")\n\n    return nil\n}\n</code></pre>"},{"location":"advanced/extensions/#2-register-command","title":"2. Register Command","text":"<pre><code>// main.go\nfunc main() {\n    // ...\n\n    switch command {\n    case \"init\":\n        err = cmd.Init()\n    case \"backup\":\n        err = cmd.Backup(args)\n    // ... other commands\n    }\n\n    // ...\n}\n</code></pre>"},{"location":"advanced/extensions/#3-add-documentation","title":"3. Add Documentation","text":"<p>Update help text and documentation to include new command.</p>"},{"location":"advanced/extensions/#common-extension-patterns","title":"Common Extension Patterns","text":""},{"location":"advanced/extensions/#template-functions","title":"Template Functions","text":"<p>Add custom gomplate functions:</p> <pre><code>// internal/render/functions.go\nfunc customFunctions() template.FuncMap {\n    return template.FuncMap{\n        \"generatePassword\": func(length int) string {\n            // Generate random password\n            return password\n        },\n        \"sha256\": func(input string) string {\n            h := sha256.New()\n            h.Write([]byte(input))\n            return hex.EncodeToString(h.Sum(nil))\n        },\n    }\n}\n\n// Update render.go to include functions\nfunc Template(templatePath string, context interface{}, outputPath string) error {\n    // Add custom functions to gomplate context\n    funcMap := customFunctions()\n    // ... pass to gomplate\n}\n</code></pre>"},{"location":"advanced/extensions/#stack-hooks","title":"Stack Hooks","text":"<p>Execute hooks before/after stack operations:</p> <pre><code>// internal/hooks/hooks.go\ntype Hook func(stackName string) error\n\nvar (\n    PreRenderHooks  []Hook\n    PostRenderHooks []Hook\n)\n\nfunc RegisterPreRender(hook Hook) {\n    PreRenderHooks = append(PreRenderHooks, hook)\n}\n\nfunc ExecutePreRender(stackName string) error {\n    for _, hook := range PreRenderHooks {\n        if err := hook(stackName); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n\n// Usage in pipeline\nfunc RenderTemplates() Stage {\n    return func(ctx *Context) error {\n        for stackName := range ctx.StackConfigs {\n            if err := hooks.ExecutePreRender(stackName); err != nil {\n                return err\n            }\n\n            // Render template...\n\n            if err := hooks.ExecutePostRender(stackName); err != nil {\n                return err\n            }\n        }\n        return nil\n    }\n}\n</code></pre>"},{"location":"advanced/extensions/#custom-variable-sources","title":"Custom Variable Sources","text":"<p>Load variables from external sources:</p> <pre><code>// internal/inventory/sources.go\ntype VariableSource interface {\n    Load() (map[string]interface{}, error)\n}\n\ntype ConsulSource struct {\n    Address string\n    Prefix  string\n}\n\nfunc (s *ConsulSource) Load() (map[string]interface{}, error) {\n    // Load from Consul KV\n    return vars, nil\n}\n\n// Merge multiple sources\nfunc LoadAll() (map[string]interface{}, error) {\n    sources := []VariableSource{\n        &amp;FileSource{Path: \"inventory/vars.yaml\"},\n        &amp;ConsulSource{Address: \"consul:8500\"},\n        &amp;EnvSource{Prefix: \"HOMELAB_\"},\n    }\n\n    merged := make(map[string]interface{})\n    for _, source := range sources {\n        vars, err := source.Load()\n        if err != nil {\n            return nil, err\n        }\n\n        // Deep merge\n        deepMerge(merged, vars)\n    }\n\n    return merged, nil\n}\n</code></pre>"},{"location":"advanced/extensions/#testing-extensions","title":"Testing Extensions","text":""},{"location":"advanced/extensions/#unit-tests","title":"Unit Tests","text":"<pre><code>// internal/myextension/extension_test.go\nfunc TestMyExtension(t *testing.T) {\n    tests := []struct {\n        name    string\n        input   string\n        want    string\n        wantErr bool\n    }{\n        {\"valid\", \"input\", \"output\", false},\n        {\"invalid\", \"bad\", \"\", true},\n    }\n\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            got, err := MyFunction(tt.input)\n            if (err != nil) != tt.wantErr {\n                t.Errorf(\"error = %v, wantErr %v\", err, tt.wantErr)\n                return\n            }\n            if got != tt.want {\n                t.Errorf(\"got %v, want %v\", got, tt.want)\n            }\n        })\n    }\n}\n</code></pre>"},{"location":"advanced/extensions/#integration-tests","title":"Integration Tests","text":"<pre><code>// cmd/integration_test.go\nfunc TestExtensionIntegration(t *testing.T) {\n    tmpDir := t.TempDir()\n    os.Chdir(tmpDir)\n\n    // Setup test repository\n    setupTestRepo(t)\n\n    // Test extension\n    err := cmd.MyExtendedCommand([]string{\"arg\"})\n    if err != nil {\n        t.Fatalf(\"command failed: %v\", err)\n    }\n\n    // Verify results\n    // ...\n}\n</code></pre>"},{"location":"advanced/extensions/#best-practices","title":"Best Practices","text":""},{"location":"advanced/extensions/#1-fail-fast","title":"1. Fail Fast","text":"<pre><code>if err != nil {\n    return err  // Don't continue on errors\n}\n</code></pre>"},{"location":"advanced/extensions/#2-actionable-errors","title":"2. Actionable Errors","text":"<pre><code>return errors.New(\n    \"extension failed\",\n    \"Check configuration in inventory/vars.yaml\",\n    \"Run: homelabctl validate\",\n)\n</code></pre>"},{"location":"advanced/extensions/#3-configuration-over-code","title":"3. Configuration Over Code","text":"<p>Prefer configuration files over hardcoded values:</p> <pre><code># inventory/vars.yaml\nextensions:\n  my_extension:\n    enabled: true\n    option: value\n</code></pre>"},{"location":"advanced/extensions/#4-preserve-determinism","title":"4. Preserve Determinism","text":"<p>Avoid: - Timestamps (unless explicitly requested) - Random values (unless seeded) - Network calls (cache results)</p>"},{"location":"advanced/extensions/#5-document-extensions","title":"5. Document Extensions","text":"<p>Add documentation for: - What the extension does - How to configure it - Example usage - Troubleshooting</p>"},{"location":"advanced/extensions/#see-also","title":"See Also","text":"<ul> <li>Architecture - System design</li> <li>Pipeline Details - Pipeline architecture</li> <li>Contributing - Development guide</li> </ul>"},{"location":"advanced/pipeline/","title":"Pipeline Details","text":"<p>The <code>generate</code> command uses a pipeline pattern for modularity, testability, and debuggability. This document explains the architecture and implementation.</p>"},{"location":"advanced/pipeline/#overview","title":"Overview","text":""},{"location":"advanced/pipeline/#pipeline-pattern","title":"Pipeline Pattern","text":"<pre><code>LoadStacks \u2192 LoadInventory \u2192 MergeVariables \u2192 FilterServices \u2192\nRenderTemplates \u2192 MergeCompose \u2192 WriteOutput \u2192 Cleanup\n</code></pre> <p>Each stage: - Operates on a shared <code>Context</code> - Returns error on failure (stops pipeline) - Is independently testable - Can be skipped for debugging</p>"},{"location":"advanced/pipeline/#benefits","title":"Benefits","text":"<p>Modularity: - Each stage has single responsibility - Easy to understand and maintain - Can be reordered if dependencies allow</p> <p>Testability: - Test stages independently - Mock context for isolated tests - Integration tests compose stages</p> <p>Debuggability: - Skip cleanup to inspect temp files - Add logging per stage - Pause pipeline at any point</p> <p>Future-proof: - Parallel execution for independent stages - Progress reporting - Caching/memoization</p>"},{"location":"advanced/pipeline/#pipeline-context","title":"Pipeline Context","text":"<p>Shared state passed through all stages:</p> <pre><code>type Context struct {\n    // Input: Enabled stacks\n    EnabledStacks []string\n\n    // Configuration\n    InventoryVars map[string]interface{}\n    DisabledServices map[string]bool\n\n    // Per-stack configuration\n    StackConfigs map[string]*StackConfig\n\n    // Rendering state\n    RenderedFiles []string\n    RenderedCompose map[string]string\n\n    // Output\n    MergedCompose *ComposeFile\n\n    // Options\n    Debug bool\n}\n\ntype StackConfig struct {\n    Stack      *Stack\n    Secrets    map[string]interface{}\n    MergedVars map[string]interface{}\n}\n</code></pre>"},{"location":"advanced/pipeline/#pipeline-stages","title":"Pipeline Stages","text":""},{"location":"advanced/pipeline/#1-loadstacks","title":"1. LoadStacks","text":"<p>Purpose: Load enabled stacks from <code>enabled/</code> symlinks</p> <p>Input: Context (empty)</p> <p>Output: <code>Context.EnabledStacks</code></p> <p>Implementation:</p> <pre><code>func LoadStacks() Stage {\n    return func(ctx *Context) error {\n        enabled, err := fs.ListEnabled()\n        if err != nil {\n            return errors.Wrap(err, \"failed to list enabled stacks\")\n        }\n\n        ctx.EnabledStacks = enabled\n        return nil\n    }\n}\n</code></pre> <p>Errors: - Repository not initialized - Invalid symlinks in <code>enabled/</code></p>"},{"location":"advanced/pipeline/#2-validatedependencies","title":"2. ValidateDependencies","text":"<p>Purpose: Ensure all dependencies are satisfied</p> <p>Input: <code>Context.EnabledStacks</code></p> <p>Output: None (validation only)</p> <p>Implementation:</p> <pre><code>func ValidateDependencies() Stage {\n    return func(ctx *Context) error {\n        // Load stack definitions\n        stacks := make(map[string]*Stack)\n        for _, name := range ctx.EnabledStacks {\n            s, err := stacks.Load(name)\n            if err != nil {\n                return err\n            }\n            stacks[name] = s\n        }\n\n        // Validate dependencies\n        return stacks.ValidateDependencies(ctx.EnabledStacks)\n    }\n}\n</code></pre> <p>Errors: - Missing dependencies - Circular dependencies - Invalid category dependencies</p>"},{"location":"advanced/pipeline/#3-loadinventory","title":"3. LoadInventory","text":"<p>Purpose: Load global configuration from <code>inventory/vars.yaml</code></p> <p>Input: Context</p> <p>Output: <code>Context.InventoryVars</code>, <code>Context.DisabledServices</code></p> <p>Implementation:</p> <pre><code>func LoadInventory() Stage {\n    return func(ctx *Context) error {\n        vars, err := inventory.Load()\n        if err != nil &amp;&amp; !os.IsNotExist(err) {\n            return errors.Wrap(err, \"failed to load inventory\")\n        }\n\n        ctx.InventoryVars = vars\n\n        // Extract disabled_services list\n        if disabled, ok := vars[\"disabled_services\"].([]interface{}); ok {\n            ctx.DisabledServices = make(map[string]bool)\n            for _, svc := range disabled {\n                ctx.DisabledServices[svc.(string)] = true\n            }\n        }\n\n        return nil\n    }\n}\n</code></pre> <p>Errors: - Invalid YAML syntax - Malformed structure</p>"},{"location":"advanced/pipeline/#4-mergevariables","title":"4. MergeVariables","text":"<p>Purpose: Merge variables for each stack (stack defaults &lt; inventory &lt; secrets)</p> <p>Input: <code>Context.EnabledStacks</code>, <code>Context.InventoryVars</code></p> <p>Output: <code>Context.StackConfigs</code></p> <p>Implementation:</p> <pre><code>func MergeVariables() Stage {\n    return func(ctx *Context) error {\n        ctx.StackConfigs = make(map[string]*StackConfig)\n\n        for _, stackName := range ctx.EnabledStacks {\n            // Load stack definition\n            stack, err := stacks.Load(stackName)\n            if err != nil {\n                return err\n            }\n\n            // Load secrets (optional)\n            secrets, err := secrets.Load(stackName)\n            if err != nil &amp;&amp; !os.IsNotExist(err) {\n                return err\n            }\n\n            // Merge: stack defaults &lt; inventory &lt; secrets\n            merged := mergeVars(\n                stack.Vars,           // Lowest priority\n                ctx.InventoryVars,    // Medium priority\n                secrets,              // Highest priority\n            )\n\n            ctx.StackConfigs[stackName] = &amp;StackConfig{\n                Stack:      stack,\n                Secrets:    secrets,\n                MergedVars: merged,\n            }\n        }\n\n        return nil\n    }\n}\n</code></pre> <p>Errors: - Failed to load stack.yaml - Failed to decrypt secrets - YAML parse errors</p>"},{"location":"advanced/pipeline/#5-rendertemplates","title":"5. RenderTemplates","text":"<p>Purpose: Render <code>compose.yml.tmpl</code> for each stack</p> <p>Input: <code>Context.StackConfigs</code></p> <p>Output: <code>Context.RenderedCompose</code>, <code>Context.RenderedFiles</code></p> <p>Implementation:</p> <pre><code>func RenderTemplates() Stage {\n    return func(ctx *Context) error {\n        ctx.RenderedCompose = make(map[string]string)\n\n        for stackName, config := range ctx.StackConfigs {\n            // Build template context\n            templateCtx := map[string]interface{}{\n                \"vars\": config.MergedVars,\n                \"stack\": map[string]string{\n                    \"name\":     stackName,\n                    \"category\": config.Stack.Category,\n                },\n                \"stacks\": map[string]interface{}{\n                    \"enabled\": ctx.EnabledStacks,\n                },\n            }\n\n            // Render template\n            templatePath := paths.StackTemplate(stackName)\n            outputPath := paths.RuntimeCompose(stackName)\n\n            if err := render.Template(templatePath, templateCtx, outputPath); err != nil {\n                return errors.Wrap(err, fmt.Sprintf(\"failed to render %s\", stackName))\n            }\n\n            ctx.RenderedCompose[stackName] = outputPath\n            ctx.RenderedFiles = append(ctx.RenderedFiles, outputPath)\n        }\n\n        return nil\n    }\n}\n</code></pre> <p>Errors: - Template syntax errors - Missing variables - Gomplate execution failure</p>"},{"location":"advanced/pipeline/#6-filterservices","title":"6. FilterServices","text":"<p>Purpose: Remove disabled services from composed files</p> <p>Input: <code>Context.RenderedCompose</code>, <code>Context.DisabledServices</code></p> <p>Output: Modified compose files (in-place)</p> <p>Implementation:</p> <pre><code>func FilterServices() Stage {\n    return func(ctx *Context) error {\n        if len(ctx.DisabledServices) == 0 {\n            return nil  // Nothing to filter\n        }\n\n        for stackName, composePath := range ctx.RenderedCompose {\n            // Load compose file\n            composeFile, err := compose.Load(composePath)\n            if err != nil {\n                return err\n            }\n\n            // Filter disabled services\n            for serviceName := range composeFile.Services {\n                if ctx.DisabledServices[serviceName] {\n                    delete(composeFile.Services, serviceName)\n                }\n            }\n\n            // Write filtered file\n            if err := compose.Write(composePath, composeFile); err != nil {\n                return err\n            }\n        }\n\n        return nil\n    }\n}\n</code></pre> <p>Errors: - Failed to load compose file - Failed to write filtered file</p>"},{"location":"advanced/pipeline/#7-mergecompose","title":"7. MergeCompose","text":"<p>Purpose: Merge all stack compose files into single <code>docker-compose.yml</code></p> <p>Input: <code>Context.RenderedCompose</code></p> <p>Output: <code>Context.MergedCompose</code></p> <p>Implementation:</p> <pre><code>func MergeCompose() Stage {\n    return func(ctx *Context) error {\n        var files []string\n        for _, path := range ctx.RenderedCompose {\n            files = append(files, path)\n        }\n\n        merged, err := compose.Merge(files...)\n        if err != nil {\n            return errors.Wrap(err, \"failed to merge compose files\")\n        }\n\n        ctx.MergedCompose = merged\n        return nil\n    }\n}\n</code></pre> <p>Errors: - Duplicate service names - Invalid compose syntax - Missing required fields</p>"},{"location":"advanced/pipeline/#8-writeoutput","title":"8. WriteOutput","text":"<p>Purpose: Write final <code>runtime/docker-compose.yml</code></p> <p>Input: <code>Context.MergedCompose</code></p> <p>Output: File on disk</p> <p>Implementation:</p> <pre><code>func WriteOutput() Stage {\n    return func(ctx *Context) error {\n        outputPath := paths.RuntimeComposeFile()\n\n        if err := compose.Write(outputPath, ctx.MergedCompose); err != nil {\n            return errors.Wrap(err, \"failed to write output\")\n        }\n\n        fmt.Printf(\"Generated: %s\\n\", outputPath)\n        return nil\n    }\n}\n</code></pre> <p>Errors: - Permission denied - Disk full - Invalid path</p>"},{"location":"advanced/pipeline/#9-cleanup","title":"9. Cleanup","text":"<p>Purpose: Remove temporary files (unless debug mode)</p> <p>Input: <code>Context.RenderedFiles</code>, <code>Context.Debug</code></p> <p>Output: Cleanup actions</p> <p>Implementation:</p> <pre><code>func Cleanup() Stage {\n    return func(ctx *Context) error {\n        if ctx.Debug {\n            fmt.Println(\"Debug mode: Preserving temporary files\")\n            return nil\n        }\n\n        for _, file := range ctx.RenderedFiles {\n            if err := os.Remove(file); err != nil &amp;&amp; !os.IsNotExist(err) {\n                // Log but don't fail on cleanup errors\n                fmt.Fprintf(os.Stderr, \"Warning: failed to remove %s: %v\\n\", file, err)\n            }\n        }\n\n        return nil\n    }\n}\n</code></pre> <p>Errors: - None (warnings only)</p>"},{"location":"advanced/pipeline/#pipeline-execution","title":"Pipeline Execution","text":""},{"location":"advanced/pipeline/#basic-usage","title":"Basic Usage","text":"<pre><code>// cmd/generate.go\nfunc Generate(debug bool) error {\n    ctx := &amp;pipeline.Context{\n        Debug: debug,\n    }\n\n    p := pipeline.New(ctx)\n    p.AddStage(pipeline.LoadStacks())\n    p.AddStage(pipeline.ValidateDependencies())\n    p.AddStage(pipeline.LoadInventory())\n    p.AddStage(pipeline.MergeVariables())\n    p.AddStage(pipeline.RenderTemplates())\n    p.AddStage(pipeline.FilterServices())\n    p.AddStage(pipeline.MergeCompose())\n    p.AddStage(pipeline.WriteOutput())\n    p.AddStage(pipeline.Cleanup())\n\n    return p.Execute()\n}\n</code></pre>"},{"location":"advanced/pipeline/#pipeline-implementation","title":"Pipeline Implementation","text":"<pre><code>// internal/pipeline/pipeline.go\ntype Pipeline struct {\n    ctx    *Context\n    stages []Stage\n}\n\ntype Stage func(*Context) error\n\nfunc New(ctx *Context) *Pipeline {\n    return &amp;Pipeline{\n        ctx:    ctx,\n        stages: []Stage{},\n    }\n}\n\nfunc (p *Pipeline) AddStage(stage Stage) {\n    p.stages = append(p.stages, stage)\n}\n\nfunc (p *Pipeline) Execute() error {\n    for i, stage := range p.stages {\n        if err := stage(p.ctx); err != nil {\n            return fmt.Errorf(\"stage %d failed: %w\", i+1, err)\n        }\n    }\n    return nil\n}\n</code></pre>"},{"location":"advanced/pipeline/#debug-mode","title":"Debug Mode","text":"<p>Preserve temporary files for inspection:</p> <pre><code>homelabctl generate --debug\n</code></pre> <p>Effect: - Cleanup stage skips deletion - Temporary files remain in <code>runtime/</code></p> <p>Inspect: <pre><code># View per-stack rendered files\ncat runtime/traefik-compose.yml\ncat runtime/authentik-compose.yml\n\n# View final merged output\ncat runtime/docker-compose.yml\n\n# Compare before/after filtering\ndiff runtime/traefik-compose.yml \\\n     runtime/docker-compose.yml\n</code></pre></p>"},{"location":"advanced/pipeline/#adding-new-stages","title":"Adding New Stages","text":""},{"location":"advanced/pipeline/#1-define-stage-function","title":"1. Define Stage Function","text":"<pre><code>// internal/pipeline/stages.go\nfunc MyCustomStage() Stage {\n    return func(ctx *Context) error {\n        // Access context\n        for _, stackName := range ctx.EnabledStacks {\n            // Do work...\n        }\n\n        // Update context\n        ctx.SomeNewField = \"value\"\n\n        return nil\n    }\n}\n</code></pre>"},{"location":"advanced/pipeline/#2-add-to-pipeline","title":"2. Add to Pipeline","text":"<pre><code>// cmd/generate.go\np.AddStage(pipeline.MyCustomStage())\n</code></pre>"},{"location":"advanced/pipeline/#3-update-context","title":"3. Update Context","text":"<p>If stage needs new state:</p> <pre><code>// internal/pipeline/context.go\ntype Context struct {\n    // ... existing fields ...\n    SomeNewField string  // New field\n}\n</code></pre>"},{"location":"advanced/pipeline/#4-test-stage","title":"4. Test Stage","text":"<pre><code>// internal/pipeline/stages_test.go\nfunc TestMyCustomStage(t *testing.T) {\n    ctx := &amp;Context{\n        EnabledStacks: []string{\"test\"},\n    }\n\n    stage := MyCustomStage()\n    err := stage(ctx)\n\n    assert.NoError(t, err)\n    assert.Equal(t, \"expected\", ctx.SomeNewField)\n}\n</code></pre>"},{"location":"advanced/pipeline/#future-enhancements","title":"Future Enhancements","text":""},{"location":"advanced/pipeline/#parallel-execution","title":"Parallel Execution","text":"<p>Independent stages can run in parallel:</p> <pre><code>// Parallel rendering\nvar wg sync.WaitGroup\nfor stackName := range ctx.StackConfigs {\n    wg.Add(1)\n    go func(name string) {\n        defer wg.Done()\n        renderStack(name)\n    }(stackName)\n}\nwg.Wait()\n</code></pre> <p>Challenges: - Error aggregation - Progress reporting - Race conditions in context</p>"},{"location":"advanced/pipeline/#progress-reporting","title":"Progress Reporting","text":"<p>Show stage progress:</p> <pre><code>func (p *Pipeline) Execute() error {\n    for i, stage := range p.stages {\n        fmt.Printf(\"[%d/%d] Running stage...\\n\", i+1, len(p.stages))\n        if err := stage(p.ctx); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n</code></pre>"},{"location":"advanced/pipeline/#caching","title":"Caching","text":"<p>Cache rendered templates if inputs unchanged:</p> <pre><code>func RenderTemplates() Stage {\n    return func(ctx *Context) error {\n        for stackName := range ctx.StackConfigs {\n            // Check cache\n            if cached, ok := checkCache(stackName); ok {\n                ctx.RenderedCompose[stackName] = cached\n                continue\n            }\n\n            // Render and cache\n            rendered := render(stackName)\n            saveCache(stackName, rendered)\n        }\n    }\n}\n</code></pre>"},{"location":"advanced/pipeline/#see-also","title":"See Also","text":"<ul> <li>Architecture - Overall system design</li> <li>Extension Points - How to extend homelabctl</li> <li>Contributing - Development guidelines</li> </ul>"},{"location":"advanced/troubleshooting/","title":"Troubleshooting","text":"<p>Common issues and solutions when using homelabctl.</p>"},{"location":"advanced/troubleshooting/#repository-issues","title":"Repository Issues","text":""},{"location":"advanced/troubleshooting/#not-in-a-homelab-repository","title":"\"Not in a homelab repository\"","text":"<p>Symptom: <pre><code>Error: not in a homelab repository\nRun: homelabctl init\n</code></pre></p> <p>Cause: Command run outside repository root</p> <p>Fix: <pre><code># Navigate to repository root\ncd /path/to/homelab\n\n# Or initialize new repository\nhomelabctl init\n</code></pre></p>"},{"location":"advanced/troubleshooting/#missing-required-directories","title":"\"Missing required directories\"","text":"<p>Symptom: <pre><code>Error: repository structure invalid\nMissing: stacks/, enabled/\n</code></pre></p> <p>Cause: Incomplete repository initialization</p> <p>Fix: <pre><code>homelabctl init  # Creates missing directories\n</code></pre></p>"},{"location":"advanced/troubleshooting/#stack-issues","title":"Stack Issues","text":""},{"location":"advanced/troubleshooting/#stack-not-found","title":"\"Stack not found\"","text":"<p>Symptom: <pre><code>Error: stack 'mystack' does not exist\n\nCheck stacks/ directory\nRun: homelabctl list\n</code></pre></p> <p>Cause: Stack directory doesn't exist</p> <p>Fix: <pre><code># List available stacks\nls stacks/\n\n# Create stack\nmkdir -p stacks/mystack\n# Add stack.yaml and compose.yml.tmpl\n</code></pre></p>"},{"location":"advanced/troubleshooting/#dependency-not-satisfied","title":"\"Dependency not satisfied\"","text":"<p>Symptom: <pre><code>Error: stack 'app' has unsatisfied dependencies\n\nDependency chain:\napp requires: [traefik]\nMissing: [traefik]\n\nTo resolve:\n  \u2192 Run: homelabctl enable traefik\n</code></pre></p> <p>Cause: Required stack not enabled</p> <p>Fix: <pre><code># Enable dependency first\nhomelabctl enable traefik\n\n# Then enable dependent stack\nhomelabctl enable app\n</code></pre></p>"},{"location":"advanced/troubleshooting/#circular-dependency-detected","title":"\"Circular dependency detected\"","text":"<p>Symptom: <pre><code>Error: circular dependency detected\n\nCycle: traefik \u2192 authentik \u2192 traefik\n\nDependencies must form a directed acyclic graph (DAG)\n</code></pre></p> <p>Cause: Stack dependencies form a loop</p> <p>Fix: <pre><code># Remove circular dependency in stack.yaml\n# Either traefik shouldn't require authentik,\n# or authentik shouldn't require traefik\n\n# Wrong:\n# stacks/traefik/stack.yaml\nrequires:\n  - authentik\n\n# stacks/authentik/stack.yaml\nrequires:\n  - traefik\n\n# Fixed:\n# stacks/authentik/stack.yaml\nrequires:\n  - traefik  # Only one direction\n</code></pre></p>"},{"location":"advanced/troubleshooting/#template-issues","title":"Template Issues","text":""},{"location":"advanced/troubleshooting/#template-syntax-error","title":"\"Template syntax error\"","text":"<p>Symptom: <pre><code>Error: failed to render traefik\ntemplate: :10:5: unexpected \"}\" in command\n</code></pre></p> <p>Cause: Invalid gomplate syntax</p> <p>Fix: <pre><code># Check template around line 10\n# Common issues:\n\n# Missing {{ end }}\n{{ if .vars.ssl }}\nenvironment:\n  - SSL=true\n# Missing: {{ end }}\n\n# Extra braces\nimage: {{ .vars.image }}}}  # One too many }\n\n# Wrong function syntax\n{{ has .stacks.enabled \"traefik\" }}  # Wrong order\n{{ has \"traefik\" .stacks.enabled }}  # Correct\n</code></pre></p>"},{"location":"advanced/troubleshooting/#missing-variable","title":"\"Missing variable\"","text":"<p>Symptom: <pre><code>template: :5:10: executing \"\" at &lt;.vars.missing&gt;: map has no entry for key \"missing\"\n</code></pre></p> <p>Cause: Variable used in template but not defined</p> <p>Fix: <pre><code># Add to stack.yaml\nvars:\n  myapp:\n    missing: \"default value\"\n\n# Or inventory/vars.yaml\nvars:\n  missing: \"global value\"\n\n# Or use default in template\nimage: {{ .vars.image | default \"nginx:latest\" }}\n</code></pre></p>"},{"location":"advanced/troubleshooting/#type-mismatch","title":"\"Type mismatch\"","text":"<p>Symptom: <pre><code>error calling eq: incompatible types for comparison\n</code></pre></p> <p>Cause: Comparing different types (string vs int, etc.)</p> <p>Fix: <pre><code># Wrong: Comparing string to int\n{{ if eq .vars.port 8080 }}\n\n# Fixed: Convert to same type\n{{ if eq .vars.port \"8080\" }}\n# or\n{{ if eq (.vars.port | int) 8080 }}\n</code></pre></p>"},{"location":"advanced/troubleshooting/#secrets-issues","title":"Secrets Issues","text":""},{"location":"advanced/troubleshooting/#failed-to-decrypt-sops","title":"\"Failed to decrypt SOPS\"","text":"<p>Symptom: <pre><code>Error: failed to decrypt secrets/traefik.enc.yaml\nsops: failed to get the data key\n</code></pre></p> <p>Cause: SOPS key not available or wrong key</p> <p>Fix: <pre><code># Check if key exists\nage-keygen -y ~/.config/sops/age/keys.txt\n\n# Verify .sops.yaml configuration\ncat .sops.yaml\n\n# Check file was encrypted with correct key\nsops -d secrets/traefik.enc.yaml\n</code></pre></p>"},{"location":"advanced/troubleshooting/#sops-not-found","title":"\"SOPS not found\"","text":"<p>Symptom: <pre><code>Error: exec: \"sops\": executable file not found in $PATH\n</code></pre></p> <p>Cause: SOPS not installed</p> <p>Fix: <pre><code># Install SOPS\napt install sops  # Debian/Ubuntu\nbrew install sops  # macOS\n\n# Or download binary\nwget https://github.com/getsops/sops/releases/latest/download/sops-linux-amd64\nchmod +x sops-linux-amd64\nsudo mv sops-linux-amd64 /usr/local/bin/sops\n</code></pre></p>"},{"location":"advanced/troubleshooting/#generation-issues","title":"Generation Issues","text":""},{"location":"advanced/troubleshooting/#duplicate-service-name","title":"\"Duplicate service name\"","text":"<p>Symptom: <pre><code>Error: failed to merge compose files\nduplicate service name: myapp\n</code></pre></p> <p>Cause: Multiple stacks define same service name</p> <p>Fix: <pre><code># Use unique service names per stack\n\n# stacks/stack1/compose.yml.tmpl\nservices:\n  stack1-myapp:  # Prefix with stack name\n    # ...\n\n# stacks/stack2/compose.yml.tmpl\nservices:\n  stack2-myapp:  # Different name\n    # ...\n</code></pre></p>"},{"location":"advanced/troubleshooting/#invalid-compose-syntax","title":"\"Invalid compose syntax\"","text":"<p>Symptom: <pre><code>Error: failed to parse compose file\nyaml: line 10: mapping values are not allowed in this context\n</code></pre></p> <p>Cause: Invalid YAML in generated compose file</p> <p>Fix: <pre><code># Generate with debug mode\nhomelabctl generate --debug\n\n# Check problematic file\ncat runtime/problematic-stack-compose.yml\n\n# Look for:\n# - Missing quotes around strings with special chars\n# - Incorrect indentation\n# - Invalid port syntax\n</code></pre></p>"},{"location":"advanced/troubleshooting/#permission-denied-writing-output","title":"\"Permission denied writing output\"","text":"<p>Symptom: <pre><code>Error: failed to write runtime/docker-compose.yml\npermission denied\n</code></pre></p> <p>Cause: Insufficient permissions</p> <p>Fix: <pre><code># Check permissions\nls -la runtime/\n\n# Fix ownership\nsudo chown -R $USER:$USER runtime/\n\n# Or run with sudo (not recommended)\nsudo homelabctl generate\n</code></pre></p>"},{"location":"advanced/troubleshooting/#deployment-issues","title":"Deployment Issues","text":""},{"location":"advanced/troubleshooting/#container-fails-to-start","title":"\"Container fails to start\"","text":"<p>Symptom: <pre><code>homelabctl ps\nmyapp    Exit 1\n</code></pre></p> <p>Cause: Various (check logs)</p> <p>Fix: <pre><code># Check service logs\nhomelabctl logs myapp\n\n# Common issues:\n# 1. Missing environment variables\n# 2. Port already in use\n# 3. Volume mount path doesn't exist\n# 4. Network issues\n\n# Check generated compose\ncat runtime/docker-compose.yml\n\n# Validate compose syntax\ndocker compose -f runtime/docker-compose.yml config\n</code></pre></p>"},{"location":"advanced/troubleshooting/#port-already-allocated","title":"\"Port already allocated\"","text":"<p>Symptom: <pre><code>Error: failed to deploy\nBind for 0.0.0.0:80 failed: port is already allocated\n</code></pre></p> <p>Cause: Another service using same port</p> <p>Fix: <pre><code># Find what's using the port\nsudo lsof -i :80\n# or\nsudo ss -tulpn | grep :80\n\n# Stop conflicting service\nsudo systemctl stop apache2\n\n# Or change port in inventory/vars.yaml\nvars:\n  myapp:\n    port: 8080  # Use different port\n</code></pre></p>"},{"location":"advanced/troubleshooting/#network-not-found","title":"\"Network not found\"","text":"<p>Symptom: <pre><code>Error: network \"traefik_default\" not found\n</code></pre></p> <p>Cause: Required network doesn't exist</p> <p>Fix: <pre><code># Deploy dependency stack first\nhomelabctl deploy traefik\n\n# Or create network manually\ndocker network create traefik_default\n</code></pre></p>"},{"location":"advanced/troubleshooting/#service-control-issues","title":"Service Control Issues","text":""},{"location":"advanced/troubleshooting/#service-not-disabled","title":"\"Service not disabled\"","text":"<p>Symptom: Service still in runtime/docker-compose.yml after <code>homelabctl disable -s service</code></p> <p>Cause: Name mismatch or not regenerated</p> <p>Fix: <pre><code># Check exact service name\nhomelabctl list\n\n# Disable with exact name\nhomelabctl disable -s exact-service-name\n\n# Regenerate compose file\nhomelabctl generate\n\n# Verify\ngrep service-name runtime/docker-compose.yml\n</code></pre></p>"},{"location":"advanced/troubleshooting/#service-not-found-error","title":"\"Service not found error\"","text":"<p>Symptom: <pre><code>Error: service 'myservice' not found in any enabled stack\n</code></pre></p> <p>Cause: Service doesn't exist or stack not enabled</p> <p>Fix: <pre><code># List all enabled stacks and services\nhomelabctl list\n\n# Enable stack containing service\nhomelabctl enable mystack\n\n# Then disable specific service\nhomelabctl disable -s myservice\n</code></pre></p>"},{"location":"advanced/troubleshooting/#validation-issues","title":"Validation Issues","text":""},{"location":"advanced/troubleshooting/#category-dependency-validation-failed","title":"\"Category dependency validation failed\"","text":"<p>Symptom: <pre><code>Error: invalid category dependency\ninfrastructure (order 2) depends on media (order 5)\n</code></pre></p> <p>Cause: Lower-order category depending on higher-order</p> <p>Fix: <pre><code># Fix category in stack.yaml\n# Either:\n# 1. Change category to higher order\nname: mystack\ncategory: media  # Match dependency category\n\n# 2. Or remove invalid dependency\nrequires:\n  # - media  # Remove this\n  - core     # OK: lower order\n</code></pre></p>"},{"location":"advanced/troubleshooting/#docker-compose-passthrough-issues","title":"Docker Compose Passthrough Issues","text":""},{"location":"advanced/troubleshooting/#unknown-docker-compose-command","title":"\"Unknown docker compose command\"","text":"<p>Symptom: <pre><code>Error: unknown command\n</code></pre></p> <p>Cause: Invalid docker compose command</p> <p>Fix: <pre><code># Check valid docker compose commands\ndocker compose --help\n\n# homelabctl passes commands directly to docker compose\nhomelabctl config   # Actually: docker compose -f runtime/docker-compose.yml config\nhomelabctl pull     # Actually: docker compose -f runtime/docker-compose.yml pull\n</code></pre></p>"},{"location":"advanced/troubleshooting/#debug-techniques","title":"Debug Techniques","text":""},{"location":"advanced/troubleshooting/#enable-debug-mode","title":"Enable Debug Mode","text":"<pre><code>homelabctl generate --debug\n</code></pre> <p>Preserves temporary files for inspection.</p>"},{"location":"advanced/troubleshooting/#inspect-temporary-files","title":"Inspect Temporary Files","text":"<pre><code># After debug generate\nls runtime/\n\n# View per-stack compose files\ncat runtime/traefik-compose.yml\ncat runtime/authentik-compose.yml\n\n# View final merged output\ncat runtime/docker-compose.yml\n</code></pre>"},{"location":"advanced/troubleshooting/#test-templates-manually","title":"Test Templates Manually","text":"<pre><code># Create test context\ncat &gt; /tmp/test-context.yaml &lt;&lt;EOF\nvars:\n  myapp:\n    image: nginx:latest\n    port: 8080\nstack:\n  name: myapp\n  category: tools\nstacks:\n  enabled:\n    - traefik\n    - myapp\nEOF\n\n# Test template\ngomplate -f stacks/myapp/compose.yml.tmpl -c .=/tmp/test-context.yaml\n</code></pre>"},{"location":"advanced/troubleshooting/#validate-compose-file","title":"Validate Compose File","text":"<pre><code># Generate compose\nhomelabctl generate\n\n# Validate syntax\ndocker compose -f runtime/docker-compose.yml config\n\n# Check for errors without starting\ndocker compose -f runtime/docker-compose.yml up --dry-run\n</code></pre>"},{"location":"advanced/troubleshooting/#check-dependencies","title":"Check Dependencies","text":"<pre><code># Visualize dependency tree\nhomelabctl list\n\n# Validate dependencies\nhomelabctl validate\n</code></pre>"},{"location":"advanced/troubleshooting/#getting-help","title":"Getting Help","text":""},{"location":"advanced/troubleshooting/#check-documentation","title":"Check Documentation","text":"<pre><code># View help\nhomelabctl --help\n\n# Check specific command\nhomelabctl generate --help\n</code></pre>"},{"location":"advanced/troubleshooting/#enable-verbose-logging","title":"Enable Verbose Logging","text":"<pre><code># Show more output\nset -x  # In bash scripts\nhomelabctl generate\nset +x\n</code></pre>"},{"location":"advanced/troubleshooting/#report-issues","title":"Report Issues","text":"<p>When reporting issues, include:</p> <ol> <li> <p>homelabctl version: <pre><code>homelabctl --version\n</code></pre></p> </li> <li> <p>Command that failed: <pre><code>homelabctl generate\n</code></pre></p> </li> <li> <p>Full error message</p> </li> <li> <p>Minimal reproduction:</p> </li> <li>Stack configuration</li> <li>Inventory vars</li> <li> <p>Steps to reproduce</p> </li> <li> <p>Environment:</p> </li> <li>OS version</li> <li>Docker version</li> <li>Go version (if building from source)</li> </ol>"},{"location":"advanced/troubleshooting/#see-also","title":"See Also","text":"<ul> <li>Architecture - Understanding homelabctl design</li> <li>Variables - Template variable system</li> <li>Secrets - Secret management</li> <li>Commands - Command reference</li> </ul>"},{"location":"contributing/code-style/","title":"Code Style","text":"<p>Coding standards and best practices for homelabctl development.</p>"},{"location":"contributing/code-style/#general-principles","title":"General Principles","text":""},{"location":"contributing/code-style/#1-fail-fast","title":"1. Fail Fast","text":"<p>Return errors immediately, never silently:</p> <pre><code>// Good\nif err != nil {\n    return err\n}\n\n// Bad\nif err != nil {\n    log.Printf(\"Warning: %v\\n\", err)\n    // Continue anyway\n}\n</code></pre>"},{"location":"contributing/code-style/#2-no-magic","title":"2. No Magic","text":"<p>All behavior must be explicit:</p> <pre><code>// Good\nfunc Enable(stackName string) error {\n    return fs.CreateSymlink(stackName)\n}\n\n// Bad - implicit behavior\nfunc Enable(stackName string) error {\n    // Automatically enables dependencies?\n    // Modifies config files?\n    // Not clear from signature\n}\n</code></pre>"},{"location":"contributing/code-style/#3-deterministic","title":"3. Deterministic","text":"<p>Same input always produces same output:</p> <pre><code>// Good\nfunc Generate() error {\n    // Reads from stacks/, inventory/, secrets/\n    // Always produces same runtime/docker-compose.yml\n}\n\n// Bad\nfunc Generate() error {\n    // Adds timestamp to output\n    // Uses random values\n    // Depends on network state\n}\n</code></pre>"},{"location":"contributing/code-style/#4-simple-over-clever","title":"4. Simple Over Clever","text":"<pre><code>// Good\nfor _, stack := range stacks {\n    if err := processStack(stack); err != nil {\n        return err\n    }\n}\n\n// Bad - clever but hard to debug\nprocessStacks := func(s []string) error { /* ... */ }\nif err := compose(map, filter, reduce)(stacks, processStacks); err != nil {\n    return err\n}\n</code></pre>"},{"location":"contributing/code-style/#go-style","title":"Go Style","text":"<p>Follow standard Go conventions:</p>"},{"location":"contributing/code-style/#formatting","title":"Formatting","text":"<pre><code># Format all code\ngo fmt ./...\n</code></pre> <p>Always run <code>go fmt</code> before committing.</p>"},{"location":"contributing/code-style/#imports","title":"Imports","text":"<p>Group imports in three sections:</p> <pre><code>import (\n    // Standard library\n    \"fmt\"\n    \"os\"\n    \"path/filepath\"\n\n    // External dependencies\n    \"gopkg.in/yaml.v3\"\n\n    // Internal packages\n    \"github.com/monkeymonk/homelabctl/internal/errors\"\n    \"github.com/monkeymonk/homelabctl/internal/stacks\"\n)\n</code></pre>"},{"location":"contributing/code-style/#naming","title":"Naming","text":"<p>Packages: - Lowercase, single word - Descriptive: <code>stacks</code>, <code>compose</code>, <code>render</code> - Not: <code>stack_manager</code>, <code>composeFiles</code></p> <p>Functions: - CamelCase for public: <code>LoadStacks()</code>, <code>ValidateDependencies()</code> - camelCase for private: <code>loadStack()</code>, <code>validateDeps()</code> - Verbs: <code>Load</code>, <code>Validate</code>, <code>Create</code>, <code>Delete</code></p> <p>Variables: - Short in small scopes: <code>err</code>, <code>i</code>, <code>s</code> - Descriptive in larger scopes: <code>stackName</code>, <code>enabledStacks</code> - No Hungarian notation: <code>strName</code> \u274c, <code>name</code> \u2705</p> <p>Constants: - CamelCase: <code>DefaultPort</code>, <code>MaxStacks</code> - Not: <code>DEFAULT_PORT</code>, <code>MAX_STACKS</code></p>"},{"location":"contributing/code-style/#comments","title":"Comments","text":"<p>Package comments: <pre><code>// Package stacks provides stack loading and validation.\npackage stacks\n</code></pre></p> <p>Function comments: <pre><code>// Load reads and parses a stack.yaml file.\n// Returns error if file doesn't exist or is invalid.\nfunc Load(stackName string) (*Stack, error) {\n    // ...\n}\n</code></pre></p> <p>Inline comments: <pre><code>// Good - explain why\n// Skip cleanup in debug mode to preserve temporary files\nif debug {\n    return nil\n}\n\n// Bad - explain what (code already says this)\n// Return nil\nreturn nil\n</code></pre></p>"},{"location":"contributing/code-style/#error-handling","title":"Error Handling","text":""},{"location":"contributing/code-style/#always-use-enhanced-errors","title":"Always Use Enhanced Errors","text":"<pre><code>import \"github.com/monkeymonk/homelabctl/internal/errors\"\n\n// Good\nreturn errors.New(\n    \"stack 'foo' does not exist\",\n    \"Run: homelabctl list\",\n    \"Check stacks/ directory\",\n)\n\n// Bad\nreturn fmt.Errorf(\"stack does not exist\")\n</code></pre>"},{"location":"contributing/code-style/#wrap-errors-with-context","title":"Wrap Errors with Context","text":"<pre><code>// Good\nif err := validateDeps(stack); err != nil {\n    return errors.Wrap(err,\n        \"dependency validation failed\",\n        \"Check stack.yaml requires field\",\n    )\n}\n\n// Bad\nif err := validateDeps(stack); err != nil {\n    return err\n}\n</code></pre>"},{"location":"contributing/code-style/#use-error-helpers","title":"Use Error Helpers","text":"<pre><code>// File not found\nreturn errors.FileNotFound(path, \"Run: homelabctl init\")\n\n// Invalid YAML\nreturn errors.InvalidYAML(path, parseErr)\n\n// Dependency cycle\nreturn errors.DependencyCycle(cycle)\n</code></pre>"},{"location":"contributing/code-style/#function-design","title":"Function Design","text":""},{"location":"contributing/code-style/#keep-functions-small","title":"Keep Functions Small","text":"<pre><code>// Good - single responsibility\nfunc Load(stackName string) (*Stack, error) {\n    path := paths.StackYAML(stackName)\n    data, err := os.ReadFile(path)\n    if err != nil {\n        return nil, err\n    }\n\n    var stack Stack\n    if err := yaml.Unmarshal(data, &amp;stack); err != nil {\n        return nil, err\n    }\n\n    return &amp;stack, nil\n}\n\n// Bad - multiple responsibilities\nfunc LoadAndValidateAndProcess(stackName string) error {\n    // 100 lines of mixed concerns\n}\n</code></pre>"},{"location":"contributing/code-style/#single-return-type","title":"Single Return Type","text":"<pre><code>// Good\nfunc Load(name string) (*Stack, error) {\n    // ...\n}\n\n// Acceptable for boolean checks\nfunc Exists(name string) bool {\n    // ...\n}\n\n// Bad\nfunc Load(name string) (*Stack, error, bool) {\n    // Too many return values\n}\n</code></pre>"},{"location":"contributing/code-style/#avoid-global-state","title":"Avoid Global State","text":"<pre><code>// Bad\nvar currentStacks []string\n\nfunc SetStacks(stacks []string) {\n    currentStacks = stacks\n}\n\nfunc GetStacks() []string {\n    return currentStacks\n}\n\n// Good - pass context explicitly\ntype Context struct {\n    Stacks []string\n}\n\nfunc Process(ctx *Context) error {\n    // Use ctx.Stacks\n}\n</code></pre>"},{"location":"contributing/code-style/#testing","title":"Testing","text":""},{"location":"contributing/code-style/#table-driven-tests","title":"Table-Driven Tests","text":"<pre><code>func TestValidateDependencies(t *testing.T) {\n    tests := []struct {\n        name    string\n        enabled []string\n        wantErr bool\n    }{\n        {\"no dependencies\", []string{\"standalone\"}, false},\n        {\"satisfied\", []string{\"core\", \"app\"}, false},\n        {\"unsatisfied\", []string{\"app\"}, true},\n        {\"circular\", []string{\"a\", \"b\"}, true},\n    }\n\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            err := ValidateDependencies(tt.enabled)\n            if (err != nil) != tt.wantErr {\n                t.Errorf(\"error = %v, wantErr %v\", err, tt.wantErr)\n            }\n        })\n    }\n}\n</code></pre>"},{"location":"contributing/code-style/#use-temporary-directories","title":"Use Temporary Directories","text":"<pre><code>func TestGenerate(t *testing.T) {\n    tmpDir := t.TempDir()  // Automatically cleaned up\n    if err := os.Chdir(tmpDir); err != nil {\n        t.Fatal(err)\n    }\n\n    // Setup test repository\n    setupTestRepo(t, tmpDir)\n\n    // Run test\n    err := Generate()\n    if err != nil {\n        t.Fatalf(\"Generate() error = %v\", err)\n    }\n\n    // Verify output\n    if !fileExists(\"runtime/docker-compose.yml\") {\n        t.Error(\"output file not created\")\n    }\n}\n</code></pre>"},{"location":"contributing/code-style/#helper-functions","title":"Helper Functions","text":"<pre><code>// Prefix with \"setup\" or \"create\"\nfunc setupTestRepo(t *testing.T, dir string) {\n    t.Helper()\n\n    dirs := []string{\"stacks\", \"enabled\", \"inventory\", \"runtime\"}\n    for _, d := range dirs {\n        if err := os.MkdirAll(filepath.Join(dir, d), 0755); err != nil {\n            t.Fatal(err)\n        }\n    }\n}\n\n// Cleanup returned as function\nfunc setupTestStack(t *testing.T) func() {\n    t.Helper()\n\n    // Setup\n    createStack(t, \"test\")\n\n    // Return cleanup\n    return func() {\n        os.RemoveAll(\"stacks/test\")\n    }\n}\n\n// Usage\ncleanup := setupTestStack(t)\ndefer cleanup()\n</code></pre>"},{"location":"contributing/code-style/#code-organization","title":"Code Organization","text":""},{"location":"contributing/code-style/#package-structure","title":"Package Structure","text":"<pre><code>internal/\n\u251c\u2500\u2500 fs/           # One concern: filesystem operations\n\u251c\u2500\u2500 stacks/       # One concern: stack management\n\u251c\u2500\u2500 compose/      # One concern: compose file operations\n\u2514\u2500\u2500 errors/       # One concern: error handling\n</code></pre>"},{"location":"contributing/code-style/#file-structure","title":"File Structure","text":"<pre><code>// mypackage.go\npackage mypackage\n\n// 1. Imports\nimport (\n    \"fmt\"\n    \"os\"\n)\n\n// 2. Constants\nconst (\n    DefaultValue = \"default\"\n)\n\n// 3. Types\ntype MyStruct struct {\n    Field string\n}\n\n// 4. Constructors\nfunc New() *MyStruct {\n    return &amp;MyStruct{}\n}\n\n// 5. Public functions (alphabetical)\nfunc PublicA() error {\n    return nil\n}\n\nfunc PublicB() error {\n    return nil\n}\n\n// 6. Private functions (alphabetical)\nfunc privateA() error {\n    return nil\n}\n\nfunc privateB() error {\n    return nil\n}\n</code></pre>"},{"location":"contributing/code-style/#test-files","title":"Test Files","text":"<pre><code>// mypackage_test.go\npackage mypackage\n\n// 1. Test helpers\nfunc setupTest(t *testing.T) {\n    t.Helper()\n    // ...\n}\n\n// 2. Tests (alphabetical)\nfunc TestPublicA(t *testing.T) {\n    // ...\n}\n\nfunc TestPublicB(t *testing.T) {\n    // ...\n}\n</code></pre>"},{"location":"contributing/code-style/#command-implementation","title":"Command Implementation","text":""},{"location":"contributing/code-style/#cmd-pattern","title":"cmd/ Pattern","text":"<pre><code>// cmd/mycommand.go\npackage cmd\n\nimport \"github.com/monkeymonk/homelabctl/internal/fs\"\n\n// Orchestration only, no business logic\nfunc MyCommand(args []string) error {\n    // 1. Verify repository\n    if err := fs.VerifyRepository(); err != nil {\n        return err\n    }\n\n    // 2. Parse arguments\n    if len(args) &lt; 1 {\n        return errors.MissingArgument(\"name\", \"mycommand\")\n    }\n    name := args[0]\n\n    // 3. Call internal packages\n    return internalPackage.DoWork(name)\n}\n</code></pre> <p>Rules: - No business logic in <code>cmd/</code> - Only orchestration and argument parsing - Call <code>internal/</code> packages for implementation - Return errors to main()</p>"},{"location":"contributing/code-style/#pipeline-stages","title":"Pipeline Stages","text":""},{"location":"contributing/code-style/#stage-pattern","title":"Stage Pattern","text":"<pre><code>func MyStage() Stage {\n    return func(ctx *Context) error {\n        // 1. Check preconditions\n        if len(ctx.EnabledStacks) == 0 {\n            return errors.New(\"no stacks enabled\")\n        }\n\n        // 2. Do work\n        for _, stack := range ctx.EnabledStacks {\n            if err := processStack(stack); err != nil {\n                return err\n            }\n        }\n\n        // 3. Update context\n        ctx.ProcessedStacks = append(ctx.ProcessedStacks, ...)\n\n        return nil\n    }\n}\n</code></pre>"},{"location":"contributing/code-style/#performance","title":"Performance","text":""},{"location":"contributing/code-style/#prefer-simplicity","title":"Prefer Simplicity","text":"<pre><code>// Good - simple and clear\nfor _, stack := range stacks {\n    if err := process(stack); err != nil {\n        return err\n    }\n}\n\n// Premature optimization\nvar wg sync.WaitGroup\nerrCh := make(chan error, len(stacks))\nfor _, stack := range stacks {\n    wg.Add(1)\n    go func(s string) {\n        defer wg.Done()\n        if err := process(s); err != nil {\n            errCh &lt;- err\n        }\n    }(stack)\n}\n// ... complex error handling\n</code></pre> <p>Only optimize when: - Profiling shows bottleneck - Significant performance impact - Complexity is justified</p>"},{"location":"contributing/code-style/#documentation","title":"Documentation","text":""},{"location":"contributing/code-style/#public-api","title":"Public API","text":"<p>Every public function, type, and constant needs a comment:</p> <pre><code>// Stack represents a homelab stack definition.\ntype Stack struct {\n    Name     string\n    Category string\n}\n\n// Load reads and parses a stack.yaml file.\n// Returns error if file doesn't exist or is invalid.\nfunc Load(stackName string) (*Stack, error) {\n    // ...\n}\n</code></pre>"},{"location":"contributing/code-style/#complex-logic","title":"Complex Logic","text":"<p>Explain why, not what:</p> <pre><code>// Good\n// Category defaults have lowest priority to allow stack-specific overrides\nmerged := merge(categoryDefaults, stackDefaults, inventoryVars, secrets)\n\n// Bad\n// Merge all the variables together\nmerged := merge(categoryDefaults, stackDefaults, inventoryVars, secrets)\n</code></pre>"},{"location":"contributing/code-style/#common-patterns","title":"Common Patterns","text":""},{"location":"contributing/code-style/#file-existence","title":"File Existence","text":"<pre><code>func fileExists(path string) bool {\n    _, err := os.Stat(path)\n    return err == nil\n}\n</code></pre>"},{"location":"contributing/code-style/#directory-creation","title":"Directory Creation","text":"<pre><code>if err := os.MkdirAll(dir, 0755); err != nil {\n    return err\n}\n</code></pre>"},{"location":"contributing/code-style/#file-reading","title":"File Reading","text":"<pre><code>data, err := os.ReadFile(path)\nif err != nil {\n    return errors.FileNotFound(path, \"Check path\")\n}\n</code></pre>"},{"location":"contributing/code-style/#yaml-parsing","title":"YAML Parsing","text":"<pre><code>var config Config\nif err := yaml.Unmarshal(data, &amp;config); err != nil {\n    return errors.InvalidYAML(path, err)\n}\n</code></pre>"},{"location":"contributing/code-style/#anti-patterns","title":"Anti-Patterns","text":""},{"location":"contributing/code-style/#dont-panic","title":"Don't Panic","text":"<pre><code>// Bad\nif err != nil {\n    panic(err)\n}\n\n// Good\nif err != nil {\n    return err\n}\n</code></pre>"},{"location":"contributing/code-style/#dont-ignore-errors","title":"Don't Ignore Errors","text":"<pre><code>// Bad\ndata, _ := os.ReadFile(path)\n\n// Good\ndata, err := os.ReadFile(path)\nif err != nil {\n    return err\n}\n</code></pre>"},{"location":"contributing/code-style/#dont-use-init","title":"Don't Use <code>init()</code>","text":"<pre><code>// Bad\nfunc init() {\n    // Global state modification\n}\n\n// Good - explicit initialization\nfunc Setup() error {\n    // ...\n}\n</code></pre>"},{"location":"contributing/code-style/#see-also","title":"See Also","text":"<ul> <li>Development Setup - Getting started</li> <li>Architecture - System design</li> <li>How to Contribute - Contribution workflow</li> </ul>"},{"location":"contributing/development/","title":"Development Setup","text":"<p>Guide for contributing to homelabctl development.</p>"},{"location":"contributing/development/#prerequisites","title":"Prerequisites","text":""},{"location":"contributing/development/#required","title":"Required","text":"<ul> <li> <p>Go 1.21+ <pre><code># Check version\ngo version\n\n# Install from https://go.dev/dl/\n</code></pre></p> </li> <li> <p>Git <pre><code>git --version\n</code></pre></p> </li> <li> <p>Docker &amp; Docker Compose <pre><code>docker --version\ndocker compose version\n</code></pre></p> </li> </ul>"},{"location":"contributing/development/#optional-for-testing","title":"Optional (for testing)","text":"<ul> <li> <p>gomplate (for template testing)   <pre><code># Install\ngo install github.com/hairyhenderson/gomplate/v3/cmd/gomplate@latest\n\n# Verify\ngomplate --version\n</code></pre></p> </li> <li> <p>SOPS (for secrets testing)   <pre><code># Linux\nwget https://github.com/getsops/sops/releases/latest/download/sops-linux-amd64\nchmod +x sops-linux-amd64\nsudo mv sops-linux-amd64 /usr/local/bin/sops\n\n# macOS\nbrew install sops\n\n# Verify\nsops --version\n</code></pre></p> </li> </ul>"},{"location":"contributing/development/#getting-started","title":"Getting Started","text":""},{"location":"contributing/development/#1-clone-repository","title":"1. Clone Repository","text":"<pre><code>git clone https://github.com/monkeymonk/homelabctl.git\ncd homelabctl\n</code></pre>"},{"location":"contributing/development/#2-install-dependencies","title":"2. Install Dependencies","text":"<pre><code># Download Go modules\ngo mod download\n\n# Verify dependencies\ngo mod verify\n</code></pre>"},{"location":"contributing/development/#3-build","title":"3. Build","text":"<pre><code># Build binary\ngo build -o homelabctl\n\n# Run from source\ngo run . --help\n</code></pre>"},{"location":"contributing/development/#4-install-locally","title":"4. Install Locally","text":"<pre><code># Install to $GOPATH/bin\ngo install\n\n# Verify installation\nhomelabctl --version\n</code></pre>"},{"location":"contributing/development/#development-workflow","title":"Development Workflow","text":""},{"location":"contributing/development/#running-tests","title":"Running Tests","text":"<pre><code># Run all tests\ngo test ./...\n\n# Run with verbose output\ngo test -v ./...\n\n# Run specific package\ngo test ./internal/stacks\n\n# Run specific test\ngo test ./internal/stacks -run TestValidateDependencies\n\n# Run with coverage\ngo test -cover ./...\n\n# Generate coverage report\ngo test -coverprofile=coverage.out ./...\ngo tool cover -html=coverage.out\n</code></pre>"},{"location":"contributing/development/#code-quality","title":"Code Quality","text":"<pre><code># Format code\ngo fmt ./...\n\n# Lint code (requires golangci-lint)\ngolangci-lint run\n\n# Check for common issues\ngo vet ./...\n</code></pre>"},{"location":"contributing/development/#local-testing","title":"Local Testing","text":"<p>Create test repository:</p> <pre><code># Create test directory\nmkdir -p /tmp/test-homelab\ncd /tmp/test-homelab\n\n# Initialize\n/path/to/homelabctl init\n\n# Create test stack\nmkdir -p stacks/test\ncat &gt; stacks/test/stack.yaml &lt;&lt;EOF\nname: test\ncategory: tools\nservices:\n  - test\nvars:\n  test:\n    image: nginx:latest\n    port: 8080\nEOF\n\ncat &gt; stacks/test/compose.yml.tmpl &lt;&lt;EOF\nservices:\n  test:\n    image: {{ .vars.test.image }}\n    container_name: test\n    ports:\n      - \"{{ .vars.test.port }}:80\"\nEOF\n\n# Enable and test\n/path/to/homelabctl enable test\n/path/to/homelabctl generate\n/path/to/homelabctl deploy\n</code></pre>"},{"location":"contributing/development/#project-structure","title":"Project Structure","text":"<pre><code>homelabctl/\n\u251c\u2500\u2500 main.go           # Entry point\n\u251c\u2500\u2500 cmd/              # Command implementations\n\u2502   \u251c\u2500\u2500 init.go\n\u2502   \u251c\u2500\u2500 enable.go\n\u2502   \u251c\u2500\u2500 generate.go\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 internal/         # Internal packages\n\u2502   \u251c\u2500\u2500 fs/           # Filesystem operations\n\u2502   \u251c\u2500\u2500 stacks/       # Stack management\n\u2502   \u251c\u2500\u2500 categories/   # Category system\n\u2502   \u251c\u2500\u2500 inventory/    # Inventory loading\n\u2502   \u251c\u2500\u2500 secrets/      # Secret management\n\u2502   \u251c\u2500\u2500 render/       # Template rendering\n\u2502   \u251c\u2500\u2500 compose/      # Compose file merging\n\u2502   \u251c\u2500\u2500 pipeline/     # Pipeline pattern\n\u2502   \u251c\u2500\u2500 errors/       # Enhanced errors\n\u2502   \u251c\u2500\u2500 paths/        # Path utilities\n\u2502   \u2514\u2500\u2500 testutil/     # Test utilities\n\u251c\u2500\u2500 docs/             # Documentation\n\u251c\u2500\u2500 testdata/         # Test fixtures\n\u251c\u2500\u2500 go.mod            # Go module definition\n\u2514\u2500\u2500 go.sum            # Dependency checksums\n</code></pre>"},{"location":"contributing/development/#coding-standards","title":"Coding Standards","text":"<p>See Code Style for detailed guidelines.</p>"},{"location":"contributing/development/#quick-reference","title":"Quick Reference","text":"<p>File Organization: <pre><code>package mypackage\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"github.com/monkeymonk/homelabctl/internal/errors\"\n)\n\n// Public functions\nfunc PublicFunction() error {\n    return privateFunction()\n}\n\n// Private functions\nfunc privateFunction() error {\n    return nil\n}\n</code></pre></p> <p>Error Handling: <pre><code>// Good\nif err != nil {\n    return errors.Wrap(err, \"operation failed\",\n        \"Check configuration\",\n        \"Run: homelabctl validate\",\n    )\n}\n\n// Bad\nif err != nil {\n    return fmt.Errorf(\"error: %v\", err)\n}\n</code></pre></p> <p>Testing: <pre><code>func TestMyFunction(t *testing.T) {\n    tests := []struct {\n        name    string\n        input   string\n        want    string\n        wantErr bool\n    }{\n        {\"valid\", \"input\", \"output\", false},\n        {\"invalid\", \"\", \"\", true},\n    }\n\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            got, err := MyFunction(tt.input)\n            if (err != nil) != tt.wantErr {\n                t.Errorf(\"error = %v, wantErr %v\", err, tt.wantErr)\n                return\n            }\n            if got != tt.want {\n                t.Errorf(\"got %v, want %v\", got, tt.want)\n            }\n        })\n    }\n}\n</code></pre></p>"},{"location":"contributing/development/#making-changes","title":"Making Changes","text":""},{"location":"contributing/development/#1-create-branch","title":"1. Create Branch","text":"<pre><code>git checkout -b feature/my-feature\n</code></pre>"},{"location":"contributing/development/#2-make-changes","title":"2. Make Changes","text":"<p>Follow Code Style guidelines.</p>"},{"location":"contributing/development/#3-write-tests","title":"3. Write Tests","text":"<pre><code>// internal/mypackage/myfile_test.go\nfunc TestMyFunction(t *testing.T) {\n    // Test implementation\n}\n</code></pre>"},{"location":"contributing/development/#4-run-tests","title":"4. Run Tests","text":"<pre><code>go test ./...\n</code></pre>"},{"location":"contributing/development/#5-commit-changes","title":"5. Commit Changes","text":"<pre><code>git add .\ngit commit -m \"Add feature: description\"\n</code></pre>"},{"location":"contributing/development/#6-push-and-create-pr","title":"6. Push and Create PR","text":"<pre><code>git push origin feature/my-feature\n</code></pre> <p>Open pull request on GitHub.</p>"},{"location":"contributing/development/#common-development-tasks","title":"Common Development Tasks","text":""},{"location":"contributing/development/#adding-a-new-command","title":"Adding a New Command","text":"<ol> <li>Create command handler:</li> </ol> <pre><code>// cmd/mycommand.go\npackage cmd\n\nfunc MyCommand(args []string) error {\n    // Implementation\n    return nil\n}\n</code></pre> <ol> <li>Register in main.go:</li> </ol> <pre><code>// main.go\nswitch command {\ncase \"mycommand\":\n    err = cmd.MyCommand(args)\n// ...\n}\n</code></pre> <ol> <li>Add tests:</li> </ol> <pre><code>// cmd/mycommand_test.go\nfunc TestMyCommand(t *testing.T) {\n    // Test cases\n}\n</code></pre> <ol> <li> <p>Update documentation:</p> </li> <li> <p>Add to <code>docs/guide/commands.md</code></p> </li> <li>Update <code>docs/reference/cli.md</code></li> </ol>"},{"location":"contributing/development/#adding-a-pipeline-stage","title":"Adding a Pipeline Stage","text":"<p>See Pipeline Details.</p>"},{"location":"contributing/development/#adding-validation-rule","title":"Adding Validation Rule","text":"<pre><code>// internal/validation/rules.go\ntype MyRule struct {\n    // Configuration\n}\n\nfunc (r *MyRule) Name() string {\n    return \"my-rule\"\n}\n\nfunc (r *MyRule) Validate(ctx *Context) error {\n    // Validation logic\n    return nil\n}\n</code></pre>"},{"location":"contributing/development/#debugging","title":"Debugging","text":"<p>Add logging:</p> <pre><code>import \"log\"\n\nlog.Printf(\"Debug: %+v\\n\", value)\n</code></pre> <p>Use delve debugger:</p> <pre><code># Install delve\ngo install github.com/go-delve/delve/cmd/dlv@latest\n\n# Debug test\ndlv test ./internal/stacks -- -test.run TestMyFunction\n\n# Debug binary\ndlv exec ./homelabctl -- generate\n</code></pre> <p>Print intermediate values:</p> <pre><code>// Temporary debugging\nfmt.Fprintf(os.Stderr, \"DEBUG: value=%+v\\n\", value)\n</code></pre>"},{"location":"contributing/development/#release-process","title":"Release Process","text":""},{"location":"contributing/development/#versioning","title":"Versioning","text":"<p>Follow Semantic Versioning:</p> <ul> <li>MAJOR: Breaking changes</li> <li>MINOR: New features (backward compatible)</li> <li>PATCH: Bug fixes</li> </ul>"},{"location":"contributing/development/#creating-release","title":"Creating Release","text":"<ol> <li>Update version:</li> </ol> <pre><code>// main.go\nconst version = \"v1.2.3\"\n</code></pre> <ol> <li>Update CHANGELOG:</li> </ol> <pre><code>## [1.2.3] - 2025-02-13\n\n### Added\n- New feature description\n\n### Fixed\n- Bug fix description\n</code></pre> <ol> <li>Create tag:</li> </ol> <pre><code>git tag -a v1.2.3 -m \"Release v1.2.3\"\ngit push origin v1.2.3\n</code></pre> <ol> <li>Build releases:</li> </ol> <pre><code># Linux\nGOOS=linux GOARCH=amd64 go build -o homelabctl-linux-amd64\n\n# macOS\nGOOS=darwin GOARCH=amd64 go build -o homelabctl-darwin-amd64\nGOOS=darwin GOARCH=arm64 go build -o homelabctl-darwin-arm64\n\n# Windows\nGOOS=windows GOARCH=amd64 go build -o homelabctl-windows-amd64.exe\n</code></pre>"},{"location":"contributing/development/#troubleshooting","title":"Troubleshooting","text":""},{"location":"contributing/development/#go-module-issues","title":"Go Module Issues","text":"<pre><code># Clean module cache\ngo clean -modcache\n\n# Re-download dependencies\ngo mod download\n\n# Tidy dependencies\ngo mod tidy\n</code></pre>"},{"location":"contributing/development/#test-failures","title":"Test Failures","text":"<pre><code># Run with verbose output\ngo test -v ./...\n\n# Run specific test\ngo test -v ./internal/stacks -run TestMyFunction\n\n# Show test coverage\ngo test -cover ./...\n</code></pre>"},{"location":"contributing/development/#build-issues","title":"Build Issues","text":"<pre><code># Clean build cache\ngo clean -cache\n\n# Rebuild\ngo build -v\n</code></pre>"},{"location":"contributing/development/#getting-help","title":"Getting Help","text":"<ul> <li>Issues: https://github.com/monkeymonk/homelabctl/issues</li> <li>Discussions: https://github.com/monkeymonk/homelabctl/discussions</li> <li>Documentation: https://monkeymonk.github.io/homelabctl/</li> </ul>"},{"location":"contributing/development/#see-also","title":"See Also","text":"<ul> <li>Code Style - Coding standards</li> <li>Architecture - System design</li> <li>How to Contribute - Contribution guidelines</li> </ul>"},{"location":"contributing/how-to-contribute/","title":"How to Contribute","text":"<p>Coming soon...</p>"},{"location":"getting-started/first-stack/","title":"Your First Stack","text":"<p>This guide walks you through creating a complete stack from scratch.</p>"},{"location":"getting-started/first-stack/#what-is-a-stack","title":"What is a Stack?","text":"<p>A stack is a collection of related Docker services defined using:</p> <ul> <li><code>stack.yaml</code> - Manifest with metadata and default variables</li> <li><code>compose.yml.tmpl</code> - Docker Compose template</li> <li><code>config/</code> (optional) - Configuration file templates</li> <li><code>contribute/</code> (optional) - Cross-stack contributions</li> </ul>"},{"location":"getting-started/first-stack/#example-traefik-reverse-proxy","title":"Example: Traefik Reverse Proxy","text":"<p>Let's create a Traefik stack as a real-world example.</p>"},{"location":"getting-started/first-stack/#1-create-stack-directory","title":"1. Create Stack Directory","text":"<pre><code>mkdir -p stacks/traefik\ncd stacks/traefik\n</code></pre>"},{"location":"getting-started/first-stack/#2-create-stackyaml","title":"2. Create stack.yaml","text":"stacks/traefik/stack.yaml<pre><code>name: traefik\ncategory: core\nrequires: []\n\nservices:\n  - traefik\n\nvars:\n  traefik:\n    image: traefik:v3.0\n    dashboard_enabled: true\n    acme_email: admin@example.com\n\npersistence:\n  volumes:\n    - traefik_acme\n</code></pre>"},{"location":"getting-started/first-stack/#3-create-composeymltmpl","title":"3. Create compose.yml.tmpl","text":"stacks/traefik/compose.yml.tmpl<pre><code>services:\n  traefik:\n    image: {{ .vars.traefik.image }}\n    container_name: traefik\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n      - \"8080:8080\"  # Dashboard\n    command:\n      - \"--api.dashboard={{ .vars.traefik.dashboard_enabled }}\"\n      - \"--providers.docker=true\"\n      - \"--providers.docker.exposedbydefault=false\"\n      - \"--entrypoints.web.address=:80\"\n      - \"--entrypoints.websecure.address=:443\"\n      - \"--certificatesresolvers.letsencrypt.acme.email={{ .vars.traefik.acme_email }}\"\n      - \"--certificatesresolvers.letsencrypt.acme.storage=/acme/acme.json\"\n      - \"--certificatesresolvers.letsencrypt.acme.httpchallenge.entrypoint=web\"\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n      - traefik_acme:/acme\n    restart: unless-stopped\n    labels:\n      - \"traefik.enable=true\"\n\nvolumes:\n  traefik_acme:\n</code></pre>"},{"location":"getting-started/first-stack/#4-override-variables-in-inventory","title":"4. Override Variables in Inventory","text":"inventory/vars.yaml<pre><code>domain: myserver.home\ntraefik:\n  acme_email: me@myserver.home\n  dashboard_enabled: false  # Disable in production\n</code></pre>"},{"location":"getting-started/first-stack/#5-enable-and-deploy","title":"5. Enable and Deploy","text":"<pre><code>cd ~/homelab\nhomelabctl enable traefik\nhomelabctl validate\nhomelabctl deploy\n</code></pre>"},{"location":"getting-started/first-stack/#6-verify","title":"6. Verify","text":"<pre><code># Check status\nhomelabctl ps\n\n# View logs\nhomelabctl logs traefik\n\n# Access dashboard (if enabled)\ncurl http://localhost:8080/dashboard/\n</code></pre>"},{"location":"getting-started/first-stack/#stack-components-explained","title":"Stack Components Explained","text":""},{"location":"getting-started/first-stack/#stackyaml","title":"stack.yaml","text":"<pre><code>name: traefik              # Stack identifier\ncategory: core             # Deployment order\nrequires: []               # Dependencies\nservices:                  # List of services (must match compose)\n  - traefik\nvars:                      # Default variables\n  traefik:\n    image: traefik:v3.0\npersistence:               # Data that survives restarts\n  volumes:\n    - traefik_acme\n</code></pre>"},{"location":"getting-started/first-stack/#composeymltmpl","title":"compose.yml.tmpl","text":"<p>Standard Docker Compose with templating:</p> <pre><code>services:\n  service-name:\n    image: {{ .vars.service.image }}  # Variable reference\n    ports:\n      - \"{{ .vars.service.port }}:80\"\n</code></pre> <p>Template Context:</p> <ul> <li><code>.vars</code> - Merged variables (stack defaults &lt; inventory &lt; secrets)</li> <li><code>.stack.name</code> - Stack name</li> <li><code>.stack.category</code> - Stack category</li> <li><code>.stacks.enabled</code> - List of enabled stacks</li> </ul>"},{"location":"getting-started/first-stack/#best-practices","title":"Best Practices","text":"<p>Keep It Simple</p> <p>Start with minimal configuration. Add complexity only when needed.</p> <p>Use Sensible Defaults</p> <p>Put common values in <code>stack.yaml</code>, let users override in inventory.</p> <p>Document Your Vars</p> <p>Add comments in <code>stack.yaml</code> explaining what each variable does.</p> <p>Don't Hardcode Secrets</p> <p>Use the secrets system for sensitive data.</p>"},{"location":"getting-started/first-stack/#next-steps","title":"Next Steps","text":"<ul> <li>Variables &amp; Templating - Deep dive into templating</li> <li>Secrets Management - Handle sensitive data</li> <li>Categories - Organize your stacks</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<p>Before installing homelabctl, ensure you have:</p> <ul> <li>Go 1.21+ (for building from source)</li> <li>Docker with Compose plugin v2</li> <li>gomplate (template engine)</li> </ul>"},{"location":"getting-started/installation/#install-gomplate","title":"Install gomplate","text":"LinuxmacOSVerify <pre><code>curl -o /usr/local/bin/gomplate -sSL \\\n  https://github.com/hairyhenderson/gomplate/releases/download/v3.11.6/gomplate_linux-amd64\nchmod +x /usr/local/bin/gomplate\n</code></pre> <pre><code>brew install gomplate\n</code></pre> <pre><code>gomplate --version\n</code></pre>"},{"location":"getting-started/installation/#installation-methods","title":"Installation Methods","text":""},{"location":"getting-started/installation/#option-1-install-from-source-recommended","title":"Option 1: Install from Source (Recommended)","text":"<pre><code>go install github.com/monkeymonk/homelabctl@latest\n</code></pre> <p>The binary will be installed to <code>$GOPATH/bin/homelabctl</code> (usually <code>~/go/bin/homelabctl</code>).</p> <p>Add to PATH</p> <p>Make sure <code>$GOPATH/bin</code> is in your PATH: <pre><code>export PATH=$PATH:$(go env GOPATH)/bin\n</code></pre></p>"},{"location":"getting-started/installation/#option-2-build-from-source","title":"Option 2: Build from Source","text":"<pre><code># Clone repository\ngit clone https://github.com/monkeymonk/homelabctl.git\ncd homelabctl\n\n# Build\ngo build -o homelabctl\n\n# Install\nsudo mv homelabctl /usr/local/bin/\n</code></pre>"},{"location":"getting-started/installation/#option-3-download-pre-built-binary","title":"Option 3: Download Pre-built Binary","text":"<p>Download the latest release for your platform from GitHub Releases.</p> Linux AMD64macOS ARM64 <pre><code>curl -LO https://github.com/monkeymonk/homelabctl/releases/latest/download/homelabctl-linux-amd64.tar.gz\ntar xzf homelabctl-linux-amd64.tar.gz\nsudo mv homelabctl /usr/local/bin/\n</code></pre> <pre><code>curl -LO https://github.com/monkeymonk/homelabctl/releases/latest/download/homelabctl-darwin-arm64.tar.gz\ntar xzf homelabctl-darwin-arm64.tar.gz\nsudo mv homelabctl /usr/local/bin/\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code>homelabctl --help\n</code></pre> <p>You should see the help output with available commands.</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide - Get up and running in 5 minutes</li> <li>Your First Stack - Create your first stack</li> </ul>"},{"location":"getting-started/installation/#updating","title":"Updating","text":""},{"location":"getting-started/installation/#from-source","title":"From source","text":"<pre><code>go install github.com/monkeymonk/homelabctl@latest\n</code></pre>"},{"location":"getting-started/installation/#homebrew","title":"Homebrew","text":"<pre><code>brew upgrade homelabctl\n</code></pre>"},{"location":"getting-started/installation/#troubleshooting","title":"Troubleshooting","text":"<p>Command not found</p> <p>If you get \"command not found\", ensure the binary is in your PATH: <pre><code>which homelabctl\n# Should show the path to the binary\n</code></pre></p> <p>gomplate not found</p> <p>Install gomplate as shown in the prerequisites section.</p> <p>Docker compose not found</p> <p>Install Docker with Compose plugin: docs.docker.com/compose/install</p>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Get homelabctl up and running in 5 minutes!</p>"},{"location":"getting-started/quickstart/#1-initialize-your-homelab","title":"1. Initialize Your Homelab","text":"<pre><code>mkdir ~/homelab &amp;&amp; cd ~/homelab\nhomelabctl init\n</code></pre> <p>This creates the required directory structure:</p> <pre><code>homelab/\n\u251c\u2500\u2500 stacks/       # Stack definitions (commit to git)\n\u251c\u2500\u2500 enabled/      # Symlinks to enabled stacks\n\u251c\u2500\u2500 inventory/    # Your configuration\n\u2502   \u2514\u2500\u2500 vars.yaml\n\u251c\u2500\u2500 secrets/      # Encrypted secrets\n\u2514\u2500\u2500 runtime/      # Generated files (gitignored)\n</code></pre>"},{"location":"getting-started/quickstart/#2-configure-your-domain","title":"2. Configure Your Domain","text":"<p>Edit <code>inventory/vars.yaml</code>:</p> <pre><code>domain: homelab.local\ntimezone: America/New_York\n</code></pre>"},{"location":"getting-started/quickstart/#3-create-your-first-stack","title":"3. Create Your First Stack","text":"<p>Create a simple nginx stack:</p> <pre><code>mkdir -p stacks/nginx\n</code></pre> <p>Create <code>stacks/nginx/stack.yaml</code>:</p> <pre><code>name: nginx\ncategory: tools\nrequires: []\nservices:\n  - nginx\nvars:\n  nginx:\n    image: nginx:alpine\n    port: 8080\n</code></pre> <p>Create <code>stacks/nginx/compose.yml.tmpl</code>:</p> <pre><code>services:\n  nginx:\n    image: {{ .vars.nginx.image }}\n    container_name: nginx\n    ports:\n      - \"{{ .vars.nginx.port }}:80\"\n    restart: unless-stopped\n</code></pre>"},{"location":"getting-started/quickstart/#4-enable-and-deploy","title":"4. Enable and Deploy","text":"<pre><code># Enable the stack\nhomelabctl enable nginx\n\n# Validate configuration\nhomelabctl validate\n\n# Generate and deploy\nhomelabctl deploy\n</code></pre>"},{"location":"getting-started/quickstart/#5-verify-its-running","title":"5. Verify It's Running","text":"<pre><code># Check service status\nhomelabctl ps\n\n# View logs\nhomelabctl logs nginx\n\n# Test the service\ncurl http://localhost:8080\n</code></pre>"},{"location":"getting-started/quickstart/#what-just-happened","title":"What Just Happened?","text":"<ol> <li>\u2705 Created a homelab repository structure</li> <li>\u2705 Configured global variables</li> <li>\u2705 Defined a stack with templates</li> <li>\u2705 Enabled and deployed the stack</li> <li>\u2705 Verified it's running</li> </ol>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Your First Stack - Deeper dive into stack creation</li> <li>Commands Reference - Learn all available commands</li> <li>Variables &amp; Templating - Advanced configuration</li> </ul>"},{"location":"getting-started/quickstart/#common-commands","title":"Common Commands","text":"<pre><code># List enabled stacks\nhomelabctl list\n\n# Disable a stack\nhomelabctl disable nginx\n\n# Regenerate after changes\nhomelabctl generate\n\n# Restart services\nhomelabctl restart nginx\n\n# Stop everything\nhomelabctl down\n</code></pre> <p>You're ready!</p> <p>You now have a working homelabctl setup. Explore the User Guide to learn more!</p>"},{"location":"guide/categories/","title":"Categories","text":"<p>Categories organize stacks and control deployment order. They're automatically discovered from stack definitions\u2014no code changes needed.</p>"},{"location":"guide/categories/#overview","title":"Overview","text":"<p>Every stack belongs to a category defined in <code>stack.yaml</code>:</p> <pre><code>name: traefik\ncategory: infrastructure  # Determines deployment order\n</code></pre> <p>Categories ensure dependencies deploy before dependents (e.g., core infrastructure before applications).</p>"},{"location":"guide/categories/#built-in-categories","title":"Built-in Categories","text":"<p>homelabctl includes predefined categories with optimized defaults:</p> Category Order Purpose Default Settings <code>core</code> 1 Essential services (DNS, auth) Security options <code>infrastructure</code> 2 Network, proxy, storage Security options <code>monitoring</code> 3 Metrics, logs, alerts - <code>automation</code> 4 CI/CD, task automation - <code>media</code> 5 Media servers, downloaders PUID/PGID <code>tools</code> 6 Utilities, management - <p>Deployment order: Core \u2192 Infrastructure \u2192 Monitoring \u2192 Automation \u2192 Media \u2192 Tools</p>"},{"location":"guide/categories/#dynamic-discovery","title":"Dynamic Discovery","text":"<p>Categories are discovered automatically from stack files. No registration required.</p>"},{"location":"guide/categories/#creating-custom-categories","title":"Creating Custom Categories","text":"<p>Just use a new category name in <code>stack.yaml</code>:</p> <pre><code>name: myapp\ncategory: custom-category  # Automatically discovered\n</code></pre> <p>Default behavior for unknown categories: - DisplayName: Auto-capitalized (<code>custom-category</code> \u2192 <code>Custom Category</code>) - Order: 999 (deploys last) - Color: white - Defaults: none</p>"},{"location":"guide/categories/#customizing-category-metadata","title":"Customizing Category Metadata","text":"<p>To add predefined settings for a custom category, edit <code>internal/categories/categories.go</code>:</p> <pre><code>\"custom-category\": {\n    Name:        \"custom-category\",\n    DisplayName: \"My Custom Category\",\n    Order:       7,  // After tools (6)\n    Color:       \"cyan\",\n    Defaults: map[string]interface{}{\n        \"restart\": \"unless-stopped\",\n        \"logging\": map[string]interface{}{\n            \"driver\": \"json-file\",\n            \"options\": map[string]string{\n                \"max-size\": \"10m\",\n                \"max-file\": \"3\",\n            },\n        },\n    },\n}\n</code></pre>"},{"location":"guide/categories/#category-defaults","title":"Category Defaults","text":"<p>Categories can provide default variables applied to all stacks in that category.</p>"},{"location":"guide/categories/#example-media-category","title":"Example: Media Category","text":"<pre><code># Predefined in code\ncategory: media\ndefaults:\n  environment:\n    PUID: 1000\n    PGID: 1000\n  restart: unless-stopped\n</code></pre> <p>All media stacks inherit these defaults:</p> <pre><code># stacks/jellyfin/stack.yaml\nname: jellyfin\ncategory: media  # Inherits PUID/PGID automatically\n</code></pre>"},{"location":"guide/categories/#variable-precedence","title":"Variable Precedence","text":"<p>Category defaults have lowest priority:</p> <pre><code>Category defaults &lt; Stack defaults &lt; Inventory &lt; Secrets\n</code></pre> <p>Example:</p> <pre><code># Category (media)\nPUID: 1000\n\n# Stack defaults\nPUID: 1001  # Overrides category\n\n# Inventory\nPUID: 1002  # Overrides stack\n\n# Secrets\nPUID: 1003  # Overrides inventory (highest)\n</code></pre>"},{"location":"guide/categories/#deployment-order","title":"Deployment Order","text":"<p>Stacks deploy in category order, then alphabetically within each category.</p>"},{"location":"guide/categories/#example-deployment-sequence","title":"Example Deployment Sequence","text":"<pre><code>1. core/\n   - dns\n   - vpn\n\n2. infrastructure/\n   - traefik\n   - authentik\n\n3. monitoring/\n   - grafana\n   - prometheus\n\n4. media/\n   - jellyfin\n   - sonarr\n\n5. custom-category/  (order: 999)\n   - myapp\n</code></pre>"},{"location":"guide/categories/#controlling-order","title":"Controlling Order","text":"<p>Option 1: Use predefined categories <pre><code>category: infrastructure  # Deploys at order 2\n</code></pre></p> <p>Option 2: Define custom order (requires code edit) <pre><code>\"myapp-category\": {\n    Order: 2.5,  // Between infrastructure (2) and monitoring (3)\n}\n</code></pre></p> <p>Option 3: Use dependencies <pre><code># Even within same category, dependencies control order\nrequires:\n  - other-stack\n</code></pre></p>"},{"location":"guide/categories/#category-validation","title":"Category Validation","text":"<p>homelabctl validates category dependencies to prevent ordering issues.</p>"},{"location":"guide/categories/#valid-dependencies","title":"Valid Dependencies","text":"<p>Higher-order categories can depend on lower-order:</p> <pre><code># \u2713 Valid: media (5) depends on infrastructure (2)\nname: jellyfin\ncategory: media\nrequires:\n  - traefik  # category: infrastructure\n</code></pre>"},{"location":"guide/categories/#invalid-dependencies","title":"Invalid Dependencies","text":"<p>Lower-order cannot depend on higher-order:</p> <pre><code># \u2717 Invalid: infrastructure (2) cannot depend on media (5)\nname: traefik\ncategory: infrastructure\nrequires:\n  - jellyfin  # category: media \u2192 ERROR\n</code></pre> <p>This prevents circular deployment issues.</p>"},{"location":"guide/categories/#listing-categories","title":"Listing Categories","text":"<p>View all discovered categories:</p> <pre><code># List enabled stacks grouped by category\nhomelabctl list\n\n# Validate category dependencies\nhomelabctl validate\n</code></pre>"},{"location":"guide/categories/#best-practices","title":"Best Practices","text":""},{"location":"guide/categories/#choose-appropriate-categories","title":"Choose Appropriate Categories","text":"<p>Match category to function:</p> <pre><code># Good: Reverse proxy is infrastructure\nname: traefik\ncategory: infrastructure\n\n# Bad: Reverse proxy as media\nname: traefik\ncategory: media  # Wrong order, may not be available\n</code></pre>"},{"location":"guide/categories/#leverage-category-defaults","title":"Leverage Category Defaults","text":"<p>Use categories to reduce boilerplate:</p> <pre><code># Media category provides PUID/PGID automatically\nname: sonarr\ncategory: media  # Inherits user/group IDs\n\n# No need to specify in every stack\n</code></pre>"},{"location":"guide/categories/#custom-categories-for-grouping","title":"Custom Categories for Grouping","text":"<p>Group related custom stacks:</p> <pre><code># All your internal tools\nname: mytool\ncategory: internal-tools\n\nname: myapp\ncategory: internal-tools\n\n# Deploy together, alphabetically\n</code></pre>"},{"location":"guide/categories/#avoid-over-categorization","title":"Avoid Over-categorization","text":"<p>Don't create too many categories:</p> <pre><code># Bad: Too specific\ncategory: media-downloaders\ncategory: media-servers\ncategory: media-management\n\n# Good: Use single category\ncategory: media\n# Let dependencies control order within category\n</code></pre>"},{"location":"guide/categories/#use-cases","title":"Use Cases","text":""},{"location":"guide/categories/#environment-separation","title":"Environment Separation","text":"<p>Categories can help separate environments:</p> <pre><code># Production services\ncategory: prod-apps\n\n# Development services\ncategory: dev-apps\n</code></pre> <p>Enable selectively:</p> <pre><code># Only production\nhomelabctl enable traefik authentik myapp\n\n# Add development\nhomelabctl enable dev-myapp dev-database\n</code></pre>"},{"location":"guide/categories/#resource-tiers","title":"Resource Tiers","text":"<p>Organize by resource requirements:</p> <pre><code># High-priority, always-on\ncategory: core\n\n# Medium priority, restartable\ncategory: services\n\n# Low priority, optional\ncategory: optional\n</code></pre>"},{"location":"guide/categories/#maintenance-windows","title":"Maintenance Windows","text":"<p>Deploy by category in maintenance windows:</p> <pre><code># Update core first\nhomelabctl restart $(homelabctl list | grep \"core/\" | awk '{print $1}')\n\n# Then infrastructure\nhomelabctl restart $(homelabctl list | grep \"infrastructure/\" | awk '{print $1}')\n</code></pre>"},{"location":"guide/categories/#see-also","title":"See Also","text":"<ul> <li>Stack Structure - How stacks are organized</li> <li>Commands - Managing stacks</li> <li>Dependencies - Stack dependency system</li> </ul>"},{"location":"guide/commands/","title":"Commands Reference","text":"<p>Complete reference for all homelabctl commands.</p>"},{"location":"guide/commands/#setup-commands","title":"Setup Commands","text":""},{"location":"guide/commands/#init","title":"<code>init</code>","text":"<p>Initialize a new homelab repository or verify an existing one.</p> <pre><code>homelabctl init\n</code></pre> <p>What it does:</p> <ul> <li>Creates required directories (<code>stacks/</code>, <code>enabled/</code>, <code>inventory/</code>, <code>secrets/</code>, <code>runtime/</code>)</li> <li>Creates starter <code>.gitignore</code></li> <li>Creates template <code>inventory/vars.yaml</code></li> </ul> <p>When to use: First time setup or structure verification.</p>"},{"location":"guide/commands/#enable","title":"<code>enable</code>","text":"<p>Enable a stack or re-enable a disabled service.</p> Enable StackEnable Service <pre><code>homelabctl enable &lt;stack&gt;\n</code></pre> <p>Creates a symlink in <code>enabled/</code> pointing to <code>stacks/&lt;stack&gt;</code>.</p> <pre><code>homelabctl enable -s &lt;service&gt;\nhomelabctl enable --service &lt;service&gt;\n</code></pre> <p>Removes service from disabled list in <code>inventory/vars.yaml</code>.</p> <p>Examples:</p> <pre><code># Enable traefik stack\nhomelabctl enable traefik\n\n# Re-enable a previously disabled service\nhomelabctl enable -s scrutiny\n</code></pre>"},{"location":"guide/commands/#disable","title":"<code>disable</code>","text":"<p>Disable a stack or an individual service.</p> Disable StackDisable Service <pre><code>homelabctl disable &lt;stack&gt;\n</code></pre> <p>Removes the symlink from <code>enabled/</code>.</p> <p>Warning</p> <p>Does not check if other stacks depend on this one.</p> <pre><code>homelabctl disable -s &lt;service&gt;\nhomelabctl disable --service &lt;service&gt;\n</code></pre> <p>Adds service to disabled list without disabling the entire stack.</p> <p>Use cases for disabling services:</p> <ul> <li>Save resources on constrained systems</li> <li>Skip services that don't work on your hardware</li> <li>Temporarily disable a service you don't need</li> </ul>"},{"location":"guide/commands/#list","title":"<code>list</code>","text":"<p>List all enabled stacks and disabled services.</p> <pre><code>homelabctl list\n</code></pre> <p>Output example:</p> <pre><code>Enabled stacks (3):\n  \u2022 core\n  \u2022 traefik\n  \u2022 monitoring\n\nDisabled services (1):\n  \u2022 scrutiny\n</code></pre>"},{"location":"guide/commands/#validate","title":"<code>validate</code>","text":"<p>Validate your homelab configuration.</p> <pre><code>homelabctl validate\n</code></pre> <p>Checks:</p> <ul> <li>\u2705 Repository structure is valid</li> <li>\u2705 All enabled stacks have <code>stack.yaml</code></li> <li>\u2705 All enabled stacks have <code>compose.yml.tmpl</code></li> <li>\u2705 All dependencies are satisfied</li> <li>\u2705 No circular dependencies</li> <li>\u2705 Service definitions match compose templates</li> </ul>"},{"location":"guide/commands/#deployment-commands","title":"Deployment Commands","text":""},{"location":"guide/commands/#generate","title":"<code>generate</code>","text":"<p>Generate runtime Docker Compose files.</p> <pre><code>homelabctl generate [--debug]\n</code></pre> <p>Flags:</p> <ul> <li><code>--debug</code> - Preserve temporary files for inspection</li> </ul> <p>What it does:</p> <ol> <li>Load enabled stacks</li> <li>Merge variables (stack defaults &lt; inventory &lt; secrets)</li> <li>Render templates with gomplate</li> <li>Filter disabled services</li> <li>Merge all compose files into <code>runtime/docker-compose.yml</code></li> </ol> <p>Output: <code>runtime/docker-compose.yml</code></p>"},{"location":"guide/commands/#deploy","title":"<code>deploy</code>","text":"<p>Generate and deploy stacks.</p> <pre><code>homelabctl deploy\n</code></pre> <p>Equivalent to:</p> <pre><code>homelabctl generate\ndocker compose -f runtime/docker-compose.yml up -d\n</code></pre> <p>When to use: After enabling/disabling stacks or changing configuration.</p>"},{"location":"guide/commands/#operations-commands","title":"Operations Commands","text":""},{"location":"guide/commands/#ps","title":"<code>ps</code>","text":"<p>Show service status.</p> <pre><code>homelabctl ps\n</code></pre> <p>Shows all running services with their status, ports, and container IDs.</p>"},{"location":"guide/commands/#logs","title":"<code>logs</code>","text":"<p>View service logs.</p> <pre><code>homelabctl logs [service...] [flags]\n</code></pre> <p>Examples:</p> <pre><code># Follow all logs\nhomelabctl logs\n\n# Follow specific service\nhomelabctl logs traefik\n\n# Last 100 lines\nhomelabctl logs -n 100\n\n# Last hour\nhomelabctl logs --since 1h\n\n# Multiple services\nhomelabctl logs traefik authentik\n</code></pre>"},{"location":"guide/commands/#restart","title":"<code>restart</code>","text":"<p>Restart services.</p> <pre><code>homelabctl restart [service...]\n</code></pre> <p>Examples:</p> <pre><code># Restart all services\nhomelabctl restart\n\n# Restart specific service\nhomelabctl restart traefik\n</code></pre>"},{"location":"guide/commands/#stop","title":"<code>stop</code>","text":"<p>Stop services (keeps containers).</p> <pre><code>homelabctl stop [service...]\n</code></pre>"},{"location":"guide/commands/#down","title":"<code>down</code>","text":"<p>Stop and remove containers.</p> <pre><code>homelabctl down [--volumes]\n</code></pre> <p>Flags:</p> <ul> <li><code>--volumes</code> - Also remove volumes (\u26a0\ufe0f data loss!)</li> </ul>"},{"location":"guide/commands/#exec","title":"<code>exec</code>","text":"<p>Execute command in a container.</p> <pre><code>homelabctl exec &lt;service&gt; &lt;command&gt; [args...]\n</code></pre> <p>Examples:</p> <pre><code># Open shell\nhomelabctl exec traefik sh\n\n# Database access\nhomelabctl exec postgres psql -U postgres\n\n# Run CLI tool\nhomelabctl exec authentik ak --version\n</code></pre>"},{"location":"guide/commands/#passthrough-commands","title":"Passthrough Commands","text":"<p>Any unrecognized command is passed to <code>docker compose</code> with the correct file:</p> <pre><code># Pull latest images\nhomelabctl pull\n\n# Validate compose file\nhomelabctl config\n\n# Show running processes\nhomelabctl top\n\n# List images\nhomelabctl images\n\n# Check port mapping\nhomelabctl port traefik 80\n\n# Stream events\nhomelabctl events\n\n# Pause/unpause\nhomelabctl pause jellyfin\nhomelabctl unpause jellyfin\n</code></pre> <p>All docker compose commands work!</p>"},{"location":"guide/commands/#debugging","title":"Debugging","text":""},{"location":"guide/commands/#preserve-temporary-files","title":"Preserve Temporary Files","text":"<pre><code>homelabctl generate --debug\n</code></pre> <p>Keeps files in <code>runtime/</code>:</p> <pre><code>runtime/\n\u251c\u2500\u2500 traefik-compose.yml      # Per-stack compose files\n\u251c\u2500\u2500 authentik-compose.yml\n\u2514\u2500\u2500 docker-compose.yml        # Final merged file\n</code></pre>"},{"location":"guide/commands/#inspect-generated-compose","title":"Inspect Generated Compose","text":"<pre><code>homelabctl config\n</code></pre> <p>Shows the final merged configuration that will be deployed.</p>"},{"location":"guide/secrets/","title":"Secrets Management","text":"<p>homelabctl supports encrypted secrets using SOPS for secure storage of sensitive configuration.</p>"},{"location":"guide/secrets/#overview","title":"Overview","text":"<p>Secrets are stored in <code>secrets/&lt;stack&gt;.yaml</code> or <code>secrets/&lt;stack&gt;.enc.yaml</code> files and automatically merged into template variables with highest priority.</p> <pre><code>Stack defaults &lt; Inventory vars &lt; Secrets\n                                  \u2191 highest priority\n</code></pre>"},{"location":"guide/secrets/#quick-start","title":"Quick Start","text":""},{"location":"guide/secrets/#1-install-sops","title":"1. Install SOPS","text":"<pre><code># Using package manager\napt install sops        # Debian/Ubuntu\nbrew install sops       # macOS\n\n# Or download binary\nwget https://github.com/getsops/sops/releases/download/v3.8.1/sops-v3.8.1.linux.amd64\nchmod +x sops-v3.8.1.linux.amd64\nsudo mv sops-v3.8.1.linux.amd64 /usr/local/bin/sops\n</code></pre>"},{"location":"guide/secrets/#2-configure-encryption","title":"2. Configure Encryption","text":"<p>SOPS supports multiple backends. Choose one:</p> <p>Age (Recommended):</p> <pre><code># Generate key\nage-keygen -o ~/.config/sops/age/keys.txt\n\n# Create .sops.yaml in repository root\ncat &gt; .sops.yaml &lt;&lt;EOF\ncreation_rules:\n  - path_regex: secrets/.*\\.enc\\.yaml$\n    age: age1ql3z7hjy54pw3hyww5ayyfg7zqgvc7w3j2elw8zmrj2kg5sfn9aqmcac8p\nEOF\n</code></pre> <p>GPG:</p> <pre><code># List GPG keys\ngpg --list-secret-keys\n\n# Create .sops.yaml\ncat &gt; .sops.yaml &lt;&lt;EOF\ncreation_rules:\n  - path_regex: secrets/.*\\.enc\\.yaml$\n    pgp: YOUR_GPG_FINGERPRINT\nEOF\n</code></pre>"},{"location":"guide/secrets/#3-create-encrypted-secrets","title":"3. Create Encrypted Secrets","text":"<pre><code># Create/edit encrypted file\nsops secrets/traefik.enc.yaml\n</code></pre> <p>Add your secrets:</p> <pre><code>vars:\n  traefik:\n    cloudflare_api_token: \"your-secret-token\"\n    admin_password: \"secure-password\"\n</code></pre> <p>Save and exit. File is automatically encrypted.</p>"},{"location":"guide/secrets/#4-use-in-templates","title":"4. Use in Templates","text":"<pre><code># stacks/traefik/compose.yml.tmpl\nservices:\n  traefik:\n    environment:\n      - CF_API_TOKEN={{ .vars.traefik.cloudflare_api_token }}\n</code></pre>"},{"location":"guide/secrets/#how-it-works","title":"How It Works","text":""},{"location":"guide/secrets/#file-detection","title":"File Detection","text":"<p>homelabctl automatically detects and decrypts secrets:</p> <ul> <li><code>secrets/&lt;stack&gt;.enc.yaml</code> \u2192 Decrypted with SOPS</li> <li><code>secrets/&lt;stack&gt;.yaml</code> \u2192 Loaded as plain YAML (not recommended)</li> </ul>"},{"location":"guide/secrets/#decryption-process","title":"Decryption Process","text":"<p>When you run <code>homelabctl generate</code> or <code>homelabctl deploy</code>:</p> <ol> <li>homelabctl checks for <code>secrets/&lt;stack&gt;.enc.yaml</code></li> <li>Runs <code>sops -d secrets/&lt;stack&gt;.enc.yaml</code></li> <li>Merges decrypted values into template context</li> <li>Renders templates</li> <li>Decrypted values never touch disk unencrypted</li> </ol>"},{"location":"guide/secrets/#variable-merging","title":"Variable Merging","text":"<p>Secrets override all other sources:</p> <pre><code># stack.yaml\nvars:\n  myapp:\n    api_key: \"default-key\"\n    debug: true\n\n# inventory/vars.yaml\nvars:\n  myapp:\n    debug: false\n\n# secrets/myapp.enc.yaml\nvars:\n  myapp:\n    api_key: \"production-key\"\n\n# Result:\n# api_key: \"production-key\"  (from secrets)\n# debug: false               (from inventory)\n</code></pre>"},{"location":"guide/secrets/#file-structure","title":"File Structure","text":""},{"location":"guide/secrets/#encrypted-file-format","title":"Encrypted File Format","text":"<pre><code># secrets/mystack.enc.yaml (before encryption)\nvars:\n  mystack:\n    # Database credentials\n    db_password: \"super-secret\"\n    db_user: \"admin\"\n\n    # API tokens\n    api_key: \"sk_live_...\"\n\n    # OAuth secrets\n    oauth_client_secret: \"...\"\n</code></pre> <p>After encryption with SOPS, it looks like:</p> <pre><code>vars:\n    mystack:\n        db_password: ENC[AES256_GCM,data:...,iv:...,tag:...,type:str]\n        db_user: ENC[AES256_GCM,data:...,iv:...,tag:...,type:str]\n        # ... encrypted values\nsops:\n    kms: []\n    gcp_kms: []\n    azure_kv: []\n    age:\n        - recipient: age1ql3z7hjy54pw3hyww5ayyfg7zqgvc7w3j2elw8zmrj2kg5sfn9aqmcac8p\n          enc: |\n            -----BEGIN AGE ENCRYPTED FILE-----\n            ...\n            -----END AGE ENCRYPTED FILE-----\n    lastmodified: \"2025-01-15T10:30:00Z\"\n</code></pre>"},{"location":"guide/secrets/#sops-configuration","title":"SOPS Configuration","text":"<p><code>.sops.yaml</code> in repository root:</p> <pre><code># Encrypt all files in secrets/ ending in .enc.yaml\ncreation_rules:\n  - path_regex: secrets/.*\\.enc\\.yaml$\n    age: age1ql3z7hjy54pw3hyww5ayyfg7zqgvc7w3j2elw8zmrj2kg5sfn9aqmcac8p\n\n  # Optional: Different keys for different stacks\n  - path_regex: secrets/production-.*\\.enc\\.yaml$\n    age: age1production...\n</code></pre>"},{"location":"guide/secrets/#common-workflows","title":"Common Workflows","text":""},{"location":"guide/secrets/#edit-existing-secrets","title":"Edit Existing Secrets","text":"<pre><code>sops secrets/mystack.enc.yaml\n</code></pre> <p>SOPS automatically decrypts, opens editor, re-encrypts on save.</p>"},{"location":"guide/secrets/#view-secrets","title":"View Secrets","text":"<pre><code># Decrypt to stdout\nsops -d secrets/mystack.enc.yaml\n\n# Pretty print\nsops -d secrets/mystack.enc.yaml | yq\n</code></pre>"},{"location":"guide/secrets/#rotate-keys","title":"Rotate Keys","text":"<pre><code># Update .sops.yaml with new key\n# Then rotate all files:\nsops updatekeys secrets/*.enc.yaml\n</code></pre>"},{"location":"guide/secrets/#share-secrets-with-team","title":"Share Secrets with Team","text":"<pre><code># .sops.yaml - Multiple recipients\ncreation_rules:\n  - path_regex: secrets/.*\\.enc\\.yaml$\n    age: &gt;-\n      age1person1...,\n      age1person2...,\n      age1person3...\n</code></pre> <pre><code># Re-encrypt with new recipients\nsops updatekeys secrets/*.enc.yaml\n</code></pre>"},{"location":"guide/secrets/#backup-secrets","title":"Backup Secrets","text":"<pre><code># Export decrypted (CAREFUL!)\nsops -d secrets/mystack.enc.yaml &gt; backup.yaml\n\n# Better: Backup encrypted files\ncp -r secrets/ secrets-backup/\n</code></pre>"},{"location":"guide/secrets/#security-best-practices","title":"Security Best Practices","text":""},{"location":"guide/secrets/#key-management","title":"Key Management","text":"<ul> <li>Never commit <code>.age/keys.txt</code> or private GPG keys</li> <li>Store keys in password manager or hardware token</li> <li>Use separate keys for different environments (dev/staging/prod)</li> <li>Rotate keys periodically</li> </ul>"},{"location":"guide/secrets/#file-permissions","title":"File Permissions","text":"<pre><code># Restrict access to key file\nchmod 600 ~/.config/sops/age/keys.txt\n\n# Keep secrets directory restricted\nchmod 700 secrets/\n</code></pre>"},{"location":"guide/secrets/#git-configuration","title":"Git Configuration","text":"<pre><code># .gitignore - Never commit decrypted secrets\nsecrets/*.yaml\n!secrets/*.enc.yaml  # Only encrypted files\n\n# Never commit SOPS keys\n.age/\n*.key\n</code></pre>"},{"location":"guide/secrets/#environment-separation","title":"Environment Separation","text":"<pre><code>secrets/\n\u251c\u2500\u2500 dev-mystack.enc.yaml      # Development secrets\n\u251c\u2500\u2500 staging-mystack.enc.yaml  # Staging secrets\n\u2514\u2500\u2500 prod-mystack.enc.yaml     # Production secrets\n</code></pre> <p>Use different keys per environment in <code>.sops.yaml</code>.</p>"},{"location":"guide/secrets/#optional-plain-secrets","title":"Optional: Plain Secrets","text":"<p>For non-sensitive configuration, plain YAML is supported:</p> <pre><code># secrets/mystack.yaml (unencrypted)\nvars:\n  mystack:\n    feature_flag: true\n    log_level: debug\n</code></pre> <p>Not recommended for sensitive data. Use <code>.enc.yaml</code> instead.</p>"},{"location":"guide/secrets/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guide/secrets/#failed-to-get-the-data-key","title":"\"failed to get the data key\"","text":"<p>Cause: SOPS cannot decrypt (wrong key or no access)</p> <p>Fix: <pre><code># Verify key is available\nage-keygen -y ~/.config/sops/age/keys.txt\n\n# Check .sops.yaml matches key\ncat .sops.yaml\n</code></pre></p>"},{"location":"guide/secrets/#no-key-found","title":"\"no key found\"","text":"<p>Cause: Missing <code>.sops.yaml</code> or key not configured</p> <p>Fix: <pre><code># Create .sops.yaml\ncat &gt; .sops.yaml &lt;&lt;EOF\ncreation_rules:\n  - path_regex: secrets/.*\\.enc\\.yaml$\n    age: $(age-keygen -y ~/.config/sops/age/keys.txt)\nEOF\n</code></pre></p>"},{"location":"guide/secrets/#mac-mismatch","title":"\"MAC mismatch\"","text":"<p>Cause: File corrupted or tampered with</p> <p>Fix: <pre><code># Verify file integrity\nsops -d secrets/mystack.enc.yaml\n\n# If corrupted, restore from backup\ngit checkout secrets/mystack.enc.yaml\n</code></pre></p>"},{"location":"guide/secrets/#templates-not-using-secrets","title":"Templates not using secrets","text":"<p>Cause: Variable path mismatch</p> <p>Fix: <pre><code># Wrong:\nvars:\n  different_name:\n    api_key: \"...\"\n\n# Correct: Must match stack name\nvars:\n  mystack:\n    api_key: \"...\"\n</code></pre></p>"},{"location":"guide/secrets/#see-also","title":"See Also","text":"<ul> <li>Variables &amp; Templating - Variable precedence</li> <li>SOPS Documentation - Full SOPS guide</li> <li>Age Encryption - Modern encryption tool</li> <li>Stack Structure - Repository organization</li> </ul>"},{"location":"guide/service-control/","title":"Service Control","text":"<p>homelabctl allows disabling individual services without disabling entire stacks, giving fine-grained control over your deployment.</p>"},{"location":"guide/service-control/#overview","title":"Overview","text":"<p>Stack-level control: - <code>homelabctl enable &lt;stack&gt;</code> - Enable entire stack - <code>homelabctl disable &lt;stack&gt;</code> - Disable entire stack</p> <p>Service-level control: - <code>homelabctl disable -s &lt;service&gt;</code> - Disable specific service (keeps stack enabled) - <code>homelabctl enable -s &lt;service&gt;</code> - Re-enable disabled service</p> <p>Disabled services are filtered out during <code>generate</code> and won't appear in the final <code>runtime/docker-compose.yml</code>.</p>"},{"location":"guide/service-control/#why-disable-services","title":"Why Disable Services?","text":""},{"location":"guide/service-control/#hardware-limitations","title":"Hardware Limitations","text":"<p>Skip services that don't work on your hardware:</p> <pre><code># Disable S.M.A.R.T. monitoring without drives\nhomelabctl disable -s scrutiny\n\n# Disable GPU-dependent transcoding\nhomelabctl disable -s plex-transcoder\n</code></pre>"},{"location":"guide/service-control/#resource-constraints","title":"Resource Constraints","text":"<p>Save resources on constrained systems:</p> <pre><code># Disable resource-intensive services\nhomelabctl disable -s elasticsearch\nhomelabctl disable -s grafana-loki\n</code></pre>"},{"location":"guide/service-control/#temporary-changes","title":"Temporary Changes","text":"<p>Temporarily disable services during maintenance:</p> <pre><code># Disable backup service during migration\nhomelabctl disable -s backup-runner\n# ... perform migration ...\nhomelabctl enable -s backup-runner\n</code></pre>"},{"location":"guide/service-control/#feature-toggles","title":"Feature Toggles","text":"<p>Control optional features:</p> <pre><code># Disable optional monitoring\nhomelabctl disable -s metrics-exporter\n\n# Disable development tools in production\nhomelabctl disable -s debug-ui\n</code></pre>"},{"location":"guide/service-control/#how-it-works","title":"How It Works","text":""},{"location":"guide/service-control/#state-storage","title":"State Storage","text":"<p>Disabled services are stored in <code>inventory/vars.yaml</code>:</p> <pre><code># inventory/vars.yaml\ndisabled_services:\n  - scrutiny\n  - elasticsearch\n  - debug-ui\n\nvars:\n  domain: example.com\n  # ... other variables\n</code></pre> <p>This file is committed to git and shared across your team.</p>"},{"location":"guide/service-control/#generation-process","title":"Generation Process","text":"<p>When you run <code>homelabctl generate</code>:</p> <ol> <li>Load enabled stacks from <code>enabled/</code> symlinks</li> <li>Render each stack's <code>compose.yml.tmpl</code></li> <li>Filter out disabled services from compose files</li> <li>Merge filtered compose files into <code>runtime/docker-compose.yml</code></li> </ol>"},{"location":"guide/service-control/#stack-definitions-preserved","title":"Stack Definitions Preserved","text":"<p>Service definitions remain in <code>stack.yaml</code> for documentation:</p> <pre><code># stacks/monitoring/stack.yaml\nname: monitoring\nservices:\n  - prometheus   # \u2713 Enabled\n  - grafana      # \u2713 Enabled\n  - loki         # \u2717 Disabled via inventory/vars.yaml\n  - tempo        # \u2713 Enabled\n</code></pre> <p>The stack knows about all services, but <code>loki</code> won't be deployed.</p>"},{"location":"guide/service-control/#usage","title":"Usage","text":""},{"location":"guide/service-control/#disable-a-service","title":"Disable a Service","text":"<pre><code>homelabctl disable -s scrutiny\n</code></pre> <p>Output: <pre><code>Service 'scrutiny' disabled\nUpdated inventory/vars.yaml\n</code></pre></p> <p>What happens: 1. Adds <code>scrutiny</code> to <code>disabled_services</code> list in <code>inventory/vars.yaml</code> 2. Service will be excluded from next <code>generate</code> or <code>deploy</code></p>"},{"location":"guide/service-control/#re-enable-a-service","title":"Re-enable a Service","text":"<pre><code>homelabctl enable -s scrutiny\n</code></pre> <p>Output: <pre><code>Service 'scrutiny' re-enabled\nUpdated inventory/vars.yaml\n</code></pre></p> <p>What happens: 1. Removes <code>scrutiny</code> from <code>disabled_services</code> list 2. Service will be included in next <code>generate</code> or <code>deploy</code></p>"},{"location":"guide/service-control/#view-disabled-services","title":"View Disabled Services","text":"<pre><code>homelabctl list\n</code></pre> <p>Output: <pre><code>Enabled stacks:\n  core/traefik\n  infrastructure/authentik\n  monitoring/prometheus\n  monitoring/grafana\n\nDisabled services:\n  - scrutiny (in monitoring stack)\n  - loki (in monitoring stack)\n</code></pre></p>"},{"location":"guide/service-control/#validate-configuration","title":"Validate Configuration","text":"<pre><code>homelabctl validate\n</code></pre> <p>Checks: - \u2713 All disabled services exist in enabled stacks - \u2713 No dependency issues from disabled services - \u2713 Valid <code>inventory/vars.yaml</code> syntax</p>"},{"location":"guide/service-control/#examples","title":"Examples","text":""},{"location":"guide/service-control/#skip-hardware-specific-service","title":"Skip Hardware-Specific Service","text":"<pre><code># stacks/monitoring/stack.yaml\nname: monitoring\nservices:\n  - prometheus\n  - grafana\n  - scrutiny      # Requires S.M.A.R.T. drives\n</code></pre> <pre><code># System without drives\nhomelabctl enable monitoring\nhomelabctl disable -s scrutiny\nhomelabctl deploy\n</code></pre> <p>Result: Prometheus and Grafana deploy, Scrutiny skipped.</p>"},{"location":"guide/service-control/#conditional-features","title":"Conditional Features","text":"<pre><code># stacks/myapp/stack.yaml\nservices:\n  - myapp-api\n  - myapp-web\n  - myapp-worker\n  - myapp-metrics  # Optional metrics endpoint\n</code></pre> <pre><code># Production: All services\nhomelabctl enable myapp\n\n# Development: Skip metrics\nhomelabctl enable myapp\nhomelabctl disable -s myapp-metrics\n</code></pre>"},{"location":"guide/service-control/#multi-service-stack-management","title":"Multi-Service Stack Management","text":"<pre><code># stacks/media/stack.yaml\nservices:\n  - jellyfin        # Core media server\n  - sonarr          # TV management\n  - radarr          # Movie management\n  - prowlarr        # Indexer management\n  - transmission    # Downloader\n</code></pre> <pre><code># Enable stack\nhomelabctl enable media\n\n# Only want Jellyfin + Sonarr\nhomelabctl disable -s radarr\nhomelabctl disable -s prowlarr\nhomelabctl disable -s transmission\n\n# Deploy minimal media setup\nhomelabctl deploy\n</code></pre>"},{"location":"guide/service-control/#dependency-handling","title":"Dependency Handling","text":""},{"location":"guide/service-control/#service-dependencies-within-stack","title":"Service Dependencies Within Stack","text":"<p>If services depend on each other, disabling may cause issues:</p> <pre><code>services:\n  myapp:\n    depends_on:\n      - database\n  database:\n</code></pre> <pre><code># \u2717 Bad: Disable dependency\nhomelabctl disable -s database  # myapp will fail to start\n</code></pre> <p>Solution: Disable both or keep dependency enabled.</p>"},{"location":"guide/service-control/#cross-stack-dependencies","title":"Cross-Stack Dependencies","text":"<p>Disabling services doesn't affect stack-level dependencies:</p> <pre><code># stacks/myapp/stack.yaml\nname: myapp\nrequires:\n  - traefik  # Stack dependency\n\nservices:\n  - myapp-api  # Individual service\n</code></pre> <pre><code># \u2713 Safe: Stack dependencies still enforced\nhomelabctl disable -s myapp-api  # Traefik still required by stack\n</code></pre>"},{"location":"guide/service-control/#best-practices","title":"Best Practices","text":""},{"location":"guide/service-control/#document-disabled-services","title":"Document Disabled Services","text":"<p>Add comments in <code>inventory/vars.yaml</code>:</p> <pre><code># Disabled services\ndisabled_services:\n  - scrutiny       # No S.M.A.R.T. drives on this host\n  - loki           # Too resource-intensive for this setup\n  - debug-ui       # Production environment\n</code></pre>"},{"location":"guide/service-control/#use-service-naming-convention","title":"Use Service Naming Convention","text":"<p>Name services clearly in <code>stack.yaml</code>:</p> <pre><code># Good: Clear service names\nservices:\n  - myapp-api          # Core API\n  - myapp-worker       # Background jobs\n  - myapp-metrics      # Optional metrics (can disable)\n\n# Bad: Vague names\nservices:\n  - app\n  - service1\n  - service2\n</code></pre>"},{"location":"guide/service-control/#validate-after-changes","title":"Validate After Changes","text":"<p>Always validate after disabling services:</p> <pre><code>homelabctl disable -s myservice\nhomelabctl validate  # Check for issues\nhomelabctl generate  # Verify compose output\n</code></pre>"},{"location":"guide/service-control/#prefer-service-control-over-stack-control","title":"Prefer Service Control Over Stack Control","text":"<pre><code># Good: Granular control\nhomelabctl enable monitoring\nhomelabctl disable -s loki  # Skip one service\n\n# Less flexible: All or nothing\nhomelabctl disable monitoring  # Loses all monitoring\n</code></pre>"},{"location":"guide/service-control/#commit-configuration","title":"Commit Configuration","text":"<p>Disabled services persist in <code>inventory/vars.yaml</code>:</p> <pre><code>git add inventory/vars.yaml\ngit commit -m \"Disable Scrutiny on systems without drives\"\n</code></pre> <p>Team members inherit the same configuration.</p>"},{"location":"guide/service-control/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guide/service-control/#service-not-disabled","title":"Service Not Disabled","text":"<p>Symptom: Service still appears after <code>homelabctl generate</code></p> <p>Causes: 1. Typo in service name 2. Service from different stack 3. Changes not applied</p> <p>Fix: <pre><code># Verify disabled services list\ncat inventory/vars.yaml | grep disabled_services -A 10\n\n# Re-disable with exact name\nhomelabctl list  # Find exact service name\nhomelabctl disable -s exact-service-name\n\n# Regenerate\nhomelabctl generate\n</code></pre></p>"},{"location":"guide/service-control/#service-not-found-error","title":"\"Service not found\" Error","text":"<p>Symptom: <code>homelabctl disable -s myservice</code> fails</p> <p>Cause: Service not in any enabled stack</p> <p>Fix: <pre><code># List enabled stacks and their services\nhomelabctl list\n\n# Enable stack first\nhomelabctl enable mystack\n\n# Then disable service\nhomelabctl disable -s myservice\n</code></pre></p>"},{"location":"guide/service-control/#dependent-service-fails","title":"Dependent Service Fails","text":"<p>Symptom: Service fails to start after disabling another</p> <p>Cause: Disabled service was a dependency</p> <p>Fix: <pre><code># Check compose file for depends_on\ncat runtime/docker-compose.yml | grep -A5 \"myservice:\"\n\n# Re-enable dependency or disable both\nhomelabctl enable -s dependency-service\n# OR\nhomelabctl disable -s dependent-service\n</code></pre></p>"},{"location":"guide/service-control/#comparison-stack-vs-service-control","title":"Comparison: Stack vs Service Control","text":"Action Scope Command Use Case Disable stack All services <code>homelabctl disable mystack</code> Don't need entire functionality Disable service Single service <code>homelabctl disable -s myservice</code> Skip one optional/incompatible service Enable stack All services <code>homelabctl enable mystack</code> Add functionality Enable service Single service <code>homelabctl enable -s myservice</code> Re-enable previously disabled service"},{"location":"guide/service-control/#see-also","title":"See Also","text":"<ul> <li>Commands - Full command reference</li> <li>Stack Structure - How services are defined</li> <li>Variables - Configuration management</li> </ul>"},{"location":"guide/stack-structure/","title":"Stack Structure","text":"<p>Learn how stacks are organized and how to structure your homelab repository.</p>"},{"location":"guide/stack-structure/#repository-layout","title":"Repository Layout","text":"<pre><code>homelab/\n\u251c\u2500\u2500 stacks/              # Stack definitions (PUBLIC)\n\u2502   \u251c\u2500\u2500 traefik/\n\u2502   \u251c\u2500\u2500 authentik/\n\u2502   \u2514\u2500\u2500 jellyfin/\n\u251c\u2500\u2500 enabled/             # Symlinks to enabled stacks\n\u2502   \u251c\u2500\u2500 traefik -&gt; ../stacks/traefik\n\u2502   \u2514\u2500\u2500 authentik -&gt; ../stacks/authentik\n\u251c\u2500\u2500 inventory/           # Your configuration (PRIVATE)\n\u2502   \u2514\u2500\u2500 vars.yaml\n\u251c\u2500\u2500 secrets/             # Encrypted secrets (PRIVATE)\n\u2502   \u2514\u2500\u2500 traefik.enc.yaml\n\u2514\u2500\u2500 runtime/             # Generated files (NEVER COMMIT)\n    \u2514\u2500\u2500 docker-compose.yml\n</code></pre>"},{"location":"guide/stack-structure/#stack-directory-structure","title":"Stack Directory Structure","text":"<pre><code>stacks/mystack/\n\u251c\u2500\u2500 stack.yaml           # Manifest + default variables\n\u251c\u2500\u2500 compose.yml.tmpl     # Docker Compose template\n\u251c\u2500\u2500 config/              # Configuration file templates (optional)\n\u2502   \u2514\u2500\u2500 app.conf.tmpl\n\u2514\u2500\u2500 contribute/          # Cross-stack contributions (optional)\n    \u2514\u2500\u2500 traefik/\n        \u2514\u2500\u2500 routes.yml.tmpl\n</code></pre>"},{"location":"guide/stack-structure/#stackyaml-schema","title":"stack.yaml Schema","text":"<pre><code>name: mystack              # Stack identifier (must match directory name)\ncategory: tools            # Category for deployment ordering\nrequires:                  # Dependencies\n  - core\n  - traefik\nservices:                  # List of all services (REQUIRED)\n  - myapp\n  - worker\nvars:                      # Default variables\n  myapp:\n    image: myapp:latest\n    port: 8080\n  worker:\n    image: worker:latest\npersistence:               # Data persistence\n  volumes:\n    - myapp_data\n  paths:\n    - ./runtime/mystack\n</code></pre>"},{"location":"guide/stack-structure/#composeymltmpl","title":"compose.yml.tmpl","text":"<p>Standard Docker Compose file with template variables:</p> <pre><code>services:\n  myapp:\n    image: {{ .vars.myapp.image }}\n    container_name: myapp\n    ports:\n      - \"{{ .vars.myapp.port }}:8080\"\n    volumes:\n      - myapp_data:/data\n    restart: unless-stopped\n    {{ if has \"traefik\" .stacks.enabled }}\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.myapp.rule=Host(`myapp.{{ .vars.domain }}`)\"\n    {{ end }}\n\nvolumes:\n  myapp_data:\n</code></pre> <p>See Variables &amp; Templating for template syntax.</p>"},{"location":"guide/stack-structure/#best-practices","title":"Best Practices","text":""},{"location":"guide/stack-structure/#naming","title":"Naming","text":"<ul> <li>Stack names: lowercase, hyphen-separated (<code>my-stack</code>)</li> <li>Service names: match container names for clarity</li> <li>Volume names: prefix with stack name (<code>mystack_data</code>)</li> </ul>"},{"location":"guide/stack-structure/#organization","title":"Organization","text":"<ul> <li>Group related services in one stack</li> <li>Use categories to control deployment order</li> <li>Keep stacks self-contained when possible</li> </ul>"},{"location":"guide/stack-structure/#variables","title":"Variables","text":"<ul> <li>Provide sensible defaults in <code>stack.yaml</code></li> <li>Document all variables with comments</li> <li>Use nested structure for multi-service stacks</li> </ul>"},{"location":"guide/stack-structure/#files","title":"Files","text":"<ul> <li>Commit: <code>stacks/</code>, <code>enabled/</code></li> <li>Private: <code>inventory/</code>, <code>secrets/</code></li> <li>Generated: <code>runtime/</code> (gitignored)</li> </ul>"},{"location":"guide/stack-structure/#see-also","title":"See Also","text":"<ul> <li>Variables &amp; Templating</li> <li>Categories</li> <li>Secrets Management</li> </ul>"},{"location":"guide/variables/","title":"Variables &amp; Templating","text":"<p>homelabctl uses gomplate for templating, providing powerful variable substitution and logic in your Docker Compose templates.</p>"},{"location":"guide/variables/#variable-precedence","title":"Variable Precedence","text":"<p>Variables are merged from multiple sources with a strict precedence order:</p> <pre><code>Stack defaults (stack.yaml \u2192 vars)     [lowest priority]\n  \u2193 overridden by\nInventory vars (inventory/vars.yaml)\n  \u2193 overridden by\nSecrets (secrets/&lt;stack&gt;.yaml)          [highest priority]\n</code></pre> <p>Example:</p> <pre><code># stacks/jellyfin/stack.yaml\nvars:\n  jellyfin:\n    image: jellyfin/jellyfin:latest\n    port: 8096\n    theme: default\n\n# inventory/vars.yaml\nvars:\n  jellyfin:\n    port: 8080  # Overrides 8096\n\n# secrets/jellyfin.yaml\nvars:\n  jellyfin:\n    theme: dark  # Overrides \"default\"\n</code></pre> <p>Result: <code>port: 8080</code>, <code>theme: dark</code>, <code>image: jellyfin/jellyfin:latest</code></p>"},{"location":"guide/variables/#template-context","title":"Template Context","text":"<p>Every template receives a context with three top-level keys:</p> <pre><code>.vars:     # Merged variables (see precedence above)\n.stack:    # Stack metadata (name, category)\n.stacks:   # Global info (enabled: [list, of, stacks])\n</code></pre>"},{"location":"guide/variables/#vars-merged-variables","title":"<code>.vars</code> - Merged Variables","text":"<p>Access your configuration:</p> <pre><code>services:\n  myapp:\n    image: {{ .vars.myapp.image }}\n    ports:\n      - \"{{ .vars.myapp.port }}:8080\"\n    environment:\n      - DOMAIN={{ .vars.domain }}\n</code></pre>"},{"location":"guide/variables/#stack-stack-metadata","title":"<code>.stack</code> - Stack Metadata","text":"<p>Current stack information:</p> <pre><code># {{ .stack.name }} = \"jellyfin\"\n# {{ .stack.category }} = \"media\"\n\nservices:\n  {{ .stack.name }}:\n    container_name: {{ .stack.name }}\n</code></pre>"},{"location":"guide/variables/#stacks-global-information","title":"<code>.stacks</code> - Global Information","text":"<p>Check what stacks are enabled:</p> <pre><code>{{ if has \"traefik\" .stacks.enabled }}\nlabels:\n  - \"traefik.enable=true\"\n{{ end }}\n\n{{ if has \"authentik\" .stacks.enabled }}\nenvironment:\n  - OAUTH_ENABLED=true\n{{ end }}\n</code></pre>"},{"location":"guide/variables/#template-syntax","title":"Template Syntax","text":""},{"location":"guide/variables/#variable-substitution","title":"Variable Substitution","text":"<pre><code># Simple\nimage: {{ .vars.myapp.image }}\n\n# With default\nimage: {{ .vars.myapp.image | default \"nginx:latest\" }}\n\n# Nested variables\nreplicas: {{ .vars.myapp.scaling.replicas }}\n</code></pre>"},{"location":"guide/variables/#conditional-logic","title":"Conditional Logic","text":"<pre><code>{{ if .vars.myapp.ssl_enabled }}\nenvironment:\n  - SSL_CERT=/certs/cert.pem\n  - SSL_KEY=/certs/key.pem\n{{ end }}\n\n{{ if eq .vars.myapp.mode \"production\" }}\nrestart: always\n{{ else }}\nrestart: unless-stopped\n{{ end }}\n</code></pre>"},{"location":"guide/variables/#loops","title":"Loops","text":"<pre><code>{{ range .vars.myapp.domains }}\nlabels:\n  - \"traefik.http.routers.myapp.rule=Host(`{{ . }}`)\"\n{{ end }}\n</code></pre>"},{"location":"guide/variables/#functions","title":"Functions","text":"<p>Gomplate provides many built-in functions:</p> <pre><code># String manipulation\n- HOSTNAME={{ .vars.myapp.name | strings.ToUpper }}\n\n# Lists\n{{ if has \"feature-x\" .vars.myapp.features }}\nenvironment:\n  - FEATURE_X=enabled\n{{ end }}\n\n# JSON\n{{ $config := .vars.myapp.config | data.ToJSON }}\n- CONFIG={{ $config }}\n\n# Files (advanced)\n{{ $cert := file.Read \"/path/to/cert\" }}\n</code></pre> <p>See gomplate documentation for full function reference.</p>"},{"location":"guide/variables/#common-patterns","title":"Common Patterns","text":""},{"location":"guide/variables/#environment-variables","title":"Environment Variables","text":"<pre><code>environment:\n  - PUID={{ .vars.media.puid | default \"1000\" }}\n  - PGID={{ .vars.media.pgid | default \"1000\" }}\n  - TZ={{ .vars.timezone | default \"UTC\" }}\n</code></pre>"},{"location":"guide/variables/#traefik-labels","title":"Traefik Labels","text":"<pre><code>{{ if has \"traefik\" .stacks.enabled }}\nlabels:\n  - \"traefik.enable=true\"\n  - \"traefik.http.routers.{{ .stack.name }}.rule=Host(`{{ .stack.name }}.{{ .vars.domain }}`)\"\n  - \"traefik.http.routers.{{ .stack.name }}.entrypoints=websecure\"\n  - \"traefik.http.routers.{{ .stack.name }}.tls.certresolver=letsencrypt\"\n{{ end }}\n</code></pre>"},{"location":"guide/variables/#port-mapping","title":"Port Mapping","text":"<pre><code>{{ if .vars.myapp.expose_ports }}\nports:\n  - \"{{ .vars.myapp.port }}:8080\"\n{{ end }}\n</code></pre>"},{"location":"guide/variables/#multi-service-stacks","title":"Multi-Service Stacks","text":"<pre><code>services:\n  app:\n    image: {{ .vars.app.image }}\n    depends_on:\n      - db\n\n  db:\n    image: {{ .vars.db.image }}\n    environment:\n      - POSTGRES_PASSWORD={{ .vars.db.password }}\n</code></pre>"},{"location":"guide/variables/#debugging-templates","title":"Debugging Templates","text":""},{"location":"guide/variables/#generate-with-debug-mode","title":"Generate with Debug Mode","text":"<pre><code>homelabctl generate --debug\n</code></pre> <p>This preserves temporary files in <code>runtime/</code> for inspection.</p>"},{"location":"guide/variables/#test-standalone","title":"Test Standalone","text":"<p>Extract context to test templates manually:</p> <pre><code># Generate creates context files temporarily\n# You can capture and use them:\ngomplate -f stacks/mystack/compose.yml.tmpl -c .=/tmp/context.yaml\n</code></pre>"},{"location":"guide/variables/#common-errors","title":"Common Errors","text":"<p>Missing variable: <pre><code>template: :5:10: executing \"\" at &lt;.vars.missing&gt;: map has no entry for key \"missing\"\n</code></pre> \u2192 Add the variable to <code>stack.yaml</code>, <code>inventory/vars.yaml</code>, or secrets</p> <p>Type mismatch: <pre><code>error calling eq: incompatible types for comparison\n</code></pre> \u2192 Check variable types match (string vs int, etc.)</p> <p>Syntax error: <pre><code>template: :10:5: unexpected \"}\" in command\n</code></pre> \u2192 Check template syntax (missing <code>end</code>, extra braces, etc.)</p>"},{"location":"guide/variables/#best-practices","title":"Best Practices","text":""},{"location":"guide/variables/#provide-defaults","title":"Provide Defaults","text":"<p>Always provide sensible defaults in <code>stack.yaml</code>:</p> <pre><code>vars:\n  myapp:\n    image: myapp:latest\n    port: 8080\n    replicas: 1\n    debug: false\n</code></pre>"},{"location":"guide/variables/#document-variables","title":"Document Variables","text":"<p>Use comments to document configuration:</p> <pre><code>vars:\n  myapp:\n    # Container image (default: latest)\n    image: myapp:latest\n\n    # External port (1024-65535)\n    port: 8080\n\n    # Enable debug logging (true/false)\n    debug: false\n</code></pre>"},{"location":"guide/variables/#organize-hierarchically","title":"Organize Hierarchically","text":"<p>Use nested structures for clarity:</p> <pre><code>vars:\n  myapp:\n    server:\n      host: 0.0.0.0\n      port: 8080\n    database:\n      host: postgres\n      port: 5432\n    features:\n      - auth\n      - metrics\n</code></pre>"},{"location":"guide/variables/#keep-templates-simple","title":"Keep Templates Simple","text":"<p>Avoid complex logic in templates:</p> <pre><code># Good: Simple conditional\n{{ if .vars.myapp.ssl }}\n- SSL_ENABLED=true\n{{ end }}\n\n# Bad: Complex nested logic\n{{ if and (has \"traefik\" .stacks.enabled) (eq .vars.myapp.mode \"production\") (ne .vars.myapp.ssl false) }}\n...\n{{ end }}\n</code></pre> <p>Move complex logic to variables or preprocessing.</p>"},{"location":"guide/variables/#see-also","title":"See Also","text":"<ul> <li>Secrets Management - Sensitive variable handling</li> <li>Template Context Reference - Full context structure</li> <li>Stack Structure - How stacks are organized</li> <li>Gomplate Documentation - Complete template syntax</li> </ul>"},{"location":"reference/changelog/","title":"Changelog","text":"<p>Coming soon...</p>"},{"location":"reference/cli/","title":"CLI Reference","text":"<p>Coming soon...</p>"},{"location":"reference/configuration/","title":"Configuration Reference","text":"<p>Complete reference for homelabctl configuration files and options.</p>"},{"location":"reference/configuration/#repository-structure","title":"Repository Structure","text":"<pre><code>homelab/\n\u251c\u2500\u2500 stacks/              # PUBLIC - Reusable stack definitions\n\u2502   \u2514\u2500\u2500 mystack/\n\u2502       \u251c\u2500\u2500 stack.yaml           # Stack manifest\n\u2502       \u251c\u2500\u2500 compose.yml.tmpl     # Docker Compose template\n\u2502       \u251c\u2500\u2500 config/              # Optional config templates\n\u2502       \u2502   \u2514\u2500\u2500 app.conf.tmpl\n\u2502       \u2514\u2500\u2500 contribute/          # Optional cross-stack contributions\n\u2502           \u2514\u2500\u2500 traefik/\n\u2502               \u2514\u2500\u2500 routes.yml.tmpl\n\u251c\u2500\u2500 enabled/             # INVENTORY - Symlinks to enabled stacks\n\u2502   \u2514\u2500\u2500 mystack -&gt; ../stacks/mystack\n\u251c\u2500\u2500 inventory/           # PRIVATE - Your configuration\n\u2502   \u2514\u2500\u2500 vars.yaml\n\u251c\u2500\u2500 secrets/             # PRIVATE - Encrypted secrets\n\u2502   \u251c\u2500\u2500 mystack.enc.yaml\n\u2502   \u2514\u2500\u2500 .sops.yaml\n\u2514\u2500\u2500 runtime/             # GENERATED - Never commit\n    \u2514\u2500\u2500 docker-compose.yml\n</code></pre>"},{"location":"reference/configuration/#stackyaml","title":"stack.yaml","text":"<p>Stack manifest defining metadata, dependencies, and default configuration.</p>"},{"location":"reference/configuration/#schema","title":"Schema","text":"<pre><code>name: string              # Stack identifier (REQUIRED)\ncategory: string          # Deployment category (REQUIRED)\nrequires: []string        # Stack dependencies (optional)\nservices: []string        # List of all services (REQUIRED)\nvars: map                 # Default variables (optional)\npersistence:              # Data persistence (optional)\n  volumes: []string       # Docker volumes\n  paths: []string         # Host paths\n</code></pre>"},{"location":"reference/configuration/#full-example","title":"Full Example","text":"<pre><code>name: jellyfin\ncategory: media\nrequires:\n  - traefik\n  - authentik\n\nservices:\n  - jellyfin\n  - jellyfin-web\n\nvars:\n  jellyfin:\n    # Image configuration\n    image: jellyfin/jellyfin:latest\n    tag: latest\n\n    # Network configuration\n    host_port: 8096\n    expose_ports: false  # Use Traefik instead\n\n    # Media paths\n    media_path: /mnt/media\n    config_path: /mnt/config/jellyfin\n\n    # Transcoding\n    enable_gpu: false\n    gpu_vendor: nvidia  # or \"amd\", \"intel\"\n\n    # Features\n    enable_dlna: true\n    enable_discovery: true\n\n  jellyfin-web:\n    image: jellyfin/jellyfin-web:latest\n    port: 8080\n\npersistence:\n  volumes:\n    - jellyfin_config\n    - jellyfin_cache\n  paths:\n    - /mnt/media  # Mounted from host\n    - /mnt/config/jellyfin\n</code></pre>"},{"location":"reference/configuration/#field-descriptions","title":"Field Descriptions","text":"<p>name (required) - Must match directory name in <code>stacks/</code> - Lowercase, hyphen-separated - Used as stack identifier throughout system</p> <p>category (required) - Controls deployment order - Built-in: <code>core</code>, <code>infrastructure</code>, <code>monitoring</code>, <code>automation</code>, <code>media</code>, <code>tools</code> - Custom categories automatically discovered</p> <p>requires (optional) - List of stack names that must be enabled - Dependencies must form DAG (no cycles) - Category-aware (can't depend on higher-order categories)</p> <p>services (required) - Explicit list of all service names - Used for service-level control - Must match services in <code>compose.yml.tmpl</code></p> <p>vars (optional) - Default configuration values - Lowest priority (overridden by inventory and secrets) - Nested structure recommended</p> <p>persistence (optional) - Documents volumes and paths - Not enforced, purely documentation</p>"},{"location":"reference/configuration/#inventoryvarsyaml","title":"inventory/vars.yaml","text":"<p>Global configuration overriding stack defaults.</p>"},{"location":"reference/configuration/#structure","title":"Structure","text":"<pre><code># Disabled services list\ndisabled_services:\n  - service1\n  - service2\n\n# Global variables\nvars:\n  # Common configuration\n  domain: example.com\n  email: admin@example.com\n  timezone: America/New_York\n\n  # Paths\n  data_root: /mnt/storage/data\n  config_root: /mnt/storage/config\n  media_root: /mnt/media\n\n  # User/Group IDs\n  puid: 1000\n  pgid: 1000\n\n  # Stack-specific overrides\n  jellyfin:\n    host_port: 8920  # Override default 8096\n    enable_gpu: true\n    media_path: /mnt/media/jellyfin\n\n  traefik:\n    acme_email: letsencrypt@example.com\n    cloudflare_api_token: cf_token_here\n</code></pre>"},{"location":"reference/configuration/#variable-precedence","title":"Variable Precedence","text":"<pre><code>Stack vars (stack.yaml) &lt; Inventory vars (inventory/vars.yaml) &lt; Secrets (secrets/*.enc.yaml)\n</code></pre> <p>Example:</p> <pre><code># stacks/app/stack.yaml\nvars:\n  app:\n    port: 8080  # Default\n\n# inventory/vars.yaml\nvars:\n  app:\n    port: 9000  # Overrides stack default\n\n# secrets/app.enc.yaml\nvars:\n  app:\n    port: 9999  # Overrides everything\n</code></pre> <p>Result: <code>port = 9999</code></p>"},{"location":"reference/configuration/#secretsencyaml","title":"secrets/.enc.yaml <p>Encrypted secrets using SOPS.</p>","text":""},{"location":"reference/configuration/#structure_1","title":"Structure","text":"<pre><code>vars:\n  mystack:\n    # Database credentials\n    db_password: \"secret-password\"\n    db_user: \"admin\"\n\n    # API keys\n    api_key: \"sk_live_...\"\n    secret_key: \"...\"\n\n    # OAuth\n    oauth_client_id: \"...\"\n    oauth_client_secret: \"...\"\n</code></pre>"},{"location":"reference/configuration/#sops-configuration","title":"SOPS Configuration","text":"<p><code>.sops.yaml</code> in repository root:</p> <pre><code>creation_rules:\n  # Encrypt all .enc.yaml files in secrets/\n  - path_regex: secrets/.*\\.enc\\.yaml$\n    age: age1ql3z7hjy54pw3hyww5ayyfg7zqgvc7w3j2elw8zmrj2kg5sfn9aqmcac8p\n\n  # Different key for production\n  - path_regex: secrets/prod-.*\\.enc\\.yaml$\n    age: age1productionkey...\n\n  # Multiple recipients\n  - path_regex: secrets/shared-.*\\.enc\\.yaml$\n    age: &gt;-\n      age1person1...,\n      age1person2...,\n      age1person3...\n</code></pre>"},{"location":"reference/configuration/#working-with-secrets","title":"Working with Secrets","text":"<pre><code># Create/edit encrypted file\nsops secrets/mystack.enc.yaml\n\n# View decrypted content\nsops -d secrets/mystack.enc.yaml\n\n# Rotate encryption keys\nsops updatekeys secrets/*.enc.yaml\n</code></pre>"},{"location":"reference/configuration/#composeymltmpl","title":"compose.yml.tmpl <p>Docker Compose template with gomplate syntax.</p>","text":""},{"location":"reference/configuration/#template-context","title":"Template Context","text":"<p>Available in all templates:</p> <pre><code>.vars:     # Merged variables (stack &lt; inventory &lt; secrets)\n.stack:    # Stack metadata (name, category)\n.stacks:   # Global info (enabled: [list])\n</code></pre>"},{"location":"reference/configuration/#example-template","title":"Example Template","text":"<pre><code>services:\n  {{ .stack.name }}:\n    image: {{ .vars.myapp.image | default \"myapp:latest\" }}\n    container_name: {{ .stack.name }}\n\n    {{ if has \"traefik\" .stacks.enabled }}\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.{{ .stack.name }}.rule=Host(`{{ .stack.name }}.{{ .vars.domain }}`)\"\n    {{ else }}\n    ports:\n      - \"{{ .vars.myapp.port }}:8080\"\n    {{ end }}\n\n    environment:\n      - TZ={{ .vars.timezone | default \"UTC\" }}\n      - DEBUG={{ .vars.myapp.debug | default \"false\" }}\n\n    volumes:\n      - {{ .vars.data_root }}/{{ .stack.name }}:/data\n      - {{ .vars.config_root }}/{{ .stack.name }}:/config\n\n    restart: unless-stopped\n\nvolumes:\n  {{ .stack.name }}_data:\n</code></pre> <p>See Template Context Reference for details.</p>"},{"location":"reference/configuration/#category-configuration","title":"Category Configuration <p>Categories are dynamically discovered from stack definitions. No configuration file needed.</p>","text":""},{"location":"reference/configuration/#built-in-categories","title":"Built-in Categories","text":"<p>Defined in <code>internal/categories/categories.go</code>:</p> <pre><code>defaultMetadata = map[string]Metadata{\n    \"core\": {\n        Name:        \"core\",\n        DisplayName: \"Core Services\",\n        Order:       1,\n        Color:       \"blue\",\n        Defaults: map[string]interface{}{\n            \"security_opt\": []string{\"no-new-privileges:true\"},\n        },\n    },\n    \"infrastructure\": {\n        Name:        \"infrastructure\",\n        DisplayName: \"Infrastructure\",\n        Order:       2,\n        Color:       \"cyan\",\n        Defaults: map[string]interface{}{\n            \"security_opt\": []string{\"no-new-privileges:true\"},\n        },\n    },\n    \"monitoring\": {\n        Name:        \"monitoring\",\n        DisplayName: \"Monitoring\",\n        Order:       3,\n        Color:       \"green\",\n    },\n    \"automation\": {\n        Name:        \"automation\",\n        DisplayName: \"Automation\",\n        Order:       4,\n        Color:       \"yellow\",\n    },\n    \"media\": {\n        Name:        \"media\",\n        DisplayName: \"Media\",\n        Order:       5,\n        Color:       \"magenta\",\n        Defaults: map[string]interface{}{\n            \"environment\": map[string]string{\n                \"PUID\": \"1000\",\n                \"PGID\": \"1000\",\n            },\n        },\n    },\n    \"tools\": {\n        Name:        \"tools\",\n        DisplayName: \"Tools\",\n        Order:       6,\n        Color:       \"white\",\n    },\n}\n</code></pre>"},{"location":"reference/configuration/#custom-categories","title":"Custom Categories","text":"<p>Just use new category name in <code>stack.yaml</code>:</p> <pre><code>name: myapp\ncategory: custom-category  # Automatically discovered\n</code></pre> <p>To customize metadata, edit <code>internal/categories/categories.go</code>.</p>"},{"location":"reference/configuration/#directory-structure-requirements","title":"Directory Structure Requirements","text":""},{"location":"reference/configuration/#minimal-repository","title":"Minimal Repository","text":"<pre><code>homelab/\n\u251c\u2500\u2500 stacks/\n\u2502   \u2514\u2500\u2500 mystack/\n\u2502       \u251c\u2500\u2500 stack.yaml\n\u2502       \u2514\u2500\u2500 compose.yml.tmpl\n\u251c\u2500\u2500 enabled/\n\u251c\u2500\u2500 inventory/\n\u2502   \u2514\u2500\u2500 vars.yaml\n\u2514\u2500\u2500 runtime/\n</code></pre>"},{"location":"reference/configuration/#full-repository","title":"Full Repository","text":"<pre><code>homelab/\n\u251c\u2500\u2500 stacks/                   # Stack definitions\n\u2502   \u251c\u2500\u2500 traefik/\n\u2502   \u251c\u2500\u2500 authentik/\n\u2502   \u2514\u2500\u2500 jellyfin/\n\u251c\u2500\u2500 enabled/                  # Symlinks\n\u2502   \u251c\u2500\u2500 traefik -&gt; ../stacks/traefik\n\u2502   \u251c\u2500\u2500 authentik -&gt; ../stacks/authentik\n\u2502   \u2514\u2500\u2500 jellyfin -&gt; ../stacks/jellyfin\n\u251c\u2500\u2500 inventory/                # Configuration\n\u2502   \u2514\u2500\u2500 vars.yaml\n\u251c\u2500\u2500 secrets/                  # Encrypted secrets\n\u2502   \u251c\u2500\u2500 traefik.enc.yaml\n\u2502   \u251c\u2500\u2500 authentik.enc.yaml\n\u2502   \u2514\u2500\u2500 .sops.yaml\n\u2514\u2500\u2500 runtime/                  # Generated (gitignored)\n    \u251c\u2500\u2500 docker-compose.yml\n    \u2514\u2500\u2500 traefik/\n        \u2514\u2500\u2500 dynamic/\n</code></pre>"},{"location":"reference/configuration/#git-configuration","title":"Git Configuration","text":""},{"location":"reference/configuration/#gitignore","title":".gitignore","text":"<pre><code># Runtime directory (generated files)\nruntime/\n\n# Decrypted secrets\nsecrets/*.yaml\n!secrets/*.enc.yaml\n\n# SOPS keys\n.age/\n*.key\n\n# Temporary files\n*.tmp\n*.swp\n.DS_Store\n</code></pre>"},{"location":"reference/configuration/#gitattributes","title":".gitattributes","text":"<pre><code># Treat encrypted files as binary\nsecrets/*.enc.yaml binary\n</code></pre>"},{"location":"reference/configuration/#environment-variables","title":"Environment Variables <p>homelabctl reads these environment variables:</p>    Variable Purpose Default     <code>SOPS_AGE_KEY_FILE</code> SOPS age key location <code>~/.config/sops/age/keys.txt</code>   <code>HOMELAB_ROOT</code> Repository root override Current directory   <code>NO_COLOR</code> Disable colored output not set","text":""},{"location":"reference/configuration/#usage","title":"Usage","text":"<pre><code># Use different SOPS key\nexport SOPS_AGE_KEY_FILE=/path/to/key.txt\nhomelabctl generate\n\n# Disable colors\nNO_COLOR=1 homelabctl list\n\n# Override repository root\nHOMELAB_ROOT=/path/to/homelab homelabctl deploy\n</code></pre>"},{"location":"reference/configuration/#best-practices","title":"Best Practices","text":""},{"location":"reference/configuration/#stack-configuration","title":"Stack Configuration","text":"<p>DO: - Provide sensible defaults in <code>stack.yaml</code> - Document all variables with comments - Use nested variable structure - List all services explicitly</p> <p>DON'T: - Hardcode secrets in <code>stack.yaml</code> - Use flat variable structure - Omit service list</p>"},{"location":"reference/configuration/#inventory-configuration","title":"Inventory Configuration","text":"<p>DO: - Commit <code>inventory/vars.yaml</code> to git - Use for environment-specific config - Override stack defaults as needed - Document disabled services</p> <p>DON'T: - Put secrets in <code>inventory/vars.yaml</code> - Override everything (trust stack defaults) - Use for stack-specific config (use stack.yaml)</p>"},{"location":"reference/configuration/#secrets","title":"Secrets","text":"<p>DO: - Encrypt all secrets with SOPS - Use <code>.enc.yaml</code> extension - Commit encrypted files to git - Rotate keys periodically - Test decryption on new systems</p> <p>DON'T: - Commit decrypted secrets - Put secrets in inventory or stack.yaml - Share private keys in version control - Use weak encryption (GPG key size, Age key generation)</p>"},{"location":"reference/configuration/#templates","title":"Templates","text":"<p>DO: - Provide defaults for all variables - Check stack dependencies with <code>has</code> - Keep logic simple - Use consistent formatting</p> <p>DON'T: - Assume variables exist - Use complex nested logic - Hardcode values</p>"},{"location":"reference/configuration/#see-also","title":"See Also <ul> <li>Stack Structure - Repository organization</li> <li>Variables &amp; Templating - Variable system</li> <li>Secrets Management - Secret handling</li> <li>Template Context - Template context reference</li> </ul>","text":""},{"location":"reference/template-context/","title":"Template Context Reference","text":"<p>Complete reference for the template context available in <code>compose.yml.tmpl</code> and contribution templates.</p>"},{"location":"reference/template-context/#context-structure","title":"Context Structure","text":"<p>Every template receives a context object with three top-level keys:</p> <pre><code>{\n  \"vars\":   map[string]interface{},  // Merged variables\n  \"stack\":  StackMetadata,            // Current stack info\n  \"stacks\": GlobalInfo,               // All stacks info\n}\n</code></pre>"},{"location":"reference/template-context/#vars-merged-variables","title":"<code>.vars</code> - Merged Variables","text":"<p>Merged configuration from all sources with precedence order:</p> <pre><code>Stack defaults (stack.yaml) &lt; Inventory (inventory/vars.yaml) &lt; Secrets (secrets/&lt;stack&gt;.yaml)\n</code></pre>"},{"location":"reference/template-context/#structure","title":"Structure","text":"<pre><code>vars:\n  domain: \"example.com\"            # Global variable\n  timezone: \"UTC\"                  # Global variable\n\n  mystack:                         # Stack-specific variables\n    image: \"myapp:latest\"\n    port: 8080\n    features:\n      - auth\n      - metrics\n\n  another-stack:                   # Another stack's variables\n    # ... stack configuration\n</code></pre>"},{"location":"reference/template-context/#access-pattern","title":"Access Pattern","text":"<pre><code># Global variables (top-level in vars)\ndomain: {{ .vars.domain }}\n\n# Stack-specific variables (nested under stack name)\nimage: {{ .vars.mystack.image }}\nport: {{ .vars.mystack.port }}\n\n# Nested properties\n{{ range .vars.mystack.features }}\n- {{ . }}\n{{ end }}\n\n# With defaults\nimage: {{ .vars.mystack.image | default \"nginx:latest\" }}\n</code></pre>"},{"location":"reference/template-context/#common-global-variables","title":"Common Global Variables","text":"<p>These are typically defined in <code>inventory/vars.yaml</code>:</p> <pre><code>vars:\n  # Domain configuration\n  domain: example.com\n  email: admin@example.com\n\n  # Timezone\n  timezone: America/New_York\n\n  # User/Group IDs (for media stacks)\n  puid: 1000\n  pgid: 1000\n\n  # Paths\n  data_root: /mnt/data\n  config_root: /mnt/config\n\n  # Disabled services\n  disabled_services:\n    - service1\n    - service2\n</code></pre>"},{"location":"reference/template-context/#stack-stack-metadata","title":"<code>.stack</code> - Stack Metadata","text":"<p>Information about the current stack being rendered.</p>"},{"location":"reference/template-context/#structure_1","title":"Structure","text":"<pre><code>{\n  \"name\":     string,  // Stack name (e.g., \"traefik\")\n  \"category\": string,  // Stack category (e.g., \"infrastructure\")\n}\n</code></pre>"},{"location":"reference/template-context/#access-pattern_1","title":"Access Pattern","text":"<pre><code># Stack name\ncontainer_name: {{ .stack.name }}\nlabels:\n  - \"stack={{ .stack.name }}\"\n\n# Stack category\nlabels:\n  - \"category={{ .stack.category }}\"\n\n# Conditional based on stack\n{{ if eq .stack.name \"traefik\" }}\n  # Traefik-specific config\n{{ end }}\n</code></pre>"},{"location":"reference/template-context/#example","title":"Example","text":"<pre><code>services:\n  {{ .stack.name }}:\n    container_name: {{ .stack.name }}\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.{{ .stack.name }}.rule=Host(`{{ .stack.name }}.{{ .vars.domain }}`)\"\n    logging:\n      driver: json-file\n      options:\n        tag: \"{{ .stack.category }}/{{ .stack.name }}\"\n</code></pre>"},{"location":"reference/template-context/#stacks-global-information","title":"<code>.stacks</code> - Global Information","text":"<p>Information about all stacks in the deployment.</p>"},{"location":"reference/template-context/#structure_2","title":"Structure","text":"<pre><code>{\n  \"enabled\": []string,  // List of enabled stack names\n}\n</code></pre>"},{"location":"reference/template-context/#access-pattern_2","title":"Access Pattern","text":"<pre><code># Check if specific stack is enabled\n{{ if has \"traefik\" .stacks.enabled }}\nlabels:\n  - \"traefik.enable=true\"\n{{ end }}\n\n# Check multiple stacks\n{{ if and (has \"traefik\" .stacks.enabled) (has \"authentik\" .stacks.enabled) }}\nenvironment:\n  - OAUTH_ENABLED=true\n{{ end }}\n\n# Iterate enabled stacks\n{{ range .stacks.enabled }}\n  # {{ . }} is stack name\n{{ end }}\n</code></pre>"},{"location":"reference/template-context/#common-patterns","title":"Common Patterns","text":"<p>Conditional Traefik Integration:</p> <pre><code>{{ if has \"traefik\" .stacks.enabled }}\nlabels:\n  - \"traefik.enable=true\"\n  - \"traefik.http.routers.{{ .stack.name }}.rule=Host(`{{ .stack.name }}.{{ .vars.domain }}`)\"\n  - \"traefik.http.routers.{{ .stack.name }}.entrypoints=websecure\"\n  - \"traefik.http.routers.{{ .stack.name }}.tls.certresolver=letsencrypt\"\n{{ else }}\nports:\n  - \"{{ .vars.myapp.port }}:8080\"\n{{ end }}\n</code></pre> <p>Conditional OAuth:</p> <pre><code>{{ if has \"authentik\" .stacks.enabled }}\nenvironment:\n  - OAUTH_ENABLED=true\n  - OAUTH_ISSUER=https://auth.{{ .vars.domain }}\n{{ end }}\n</code></pre> <p>Dependency Check:</p> <pre><code>services:\n  myapp:\n    {{ if not (has \"postgres\" .stacks.enabled) }}\n    # Use SQLite if postgres not enabled\n    environment:\n      - DATABASE_TYPE=sqlite\n    {{ else }}\n    # Use PostgreSQL if enabled\n    environment:\n      - DATABASE_TYPE=postgres\n      - DATABASE_HOST=postgres\n    {{ end }}\n</code></pre>"},{"location":"reference/template-context/#complete-example","title":"Complete Example","text":""},{"location":"reference/template-context/#template-stacksmyappcomposeymltmpl","title":"Template: <code>stacks/myapp/compose.yml.tmpl</code>","text":"<pre><code>services:\n  {{ .stack.name }}:\n    image: {{ .vars.myapp.image | default \"myapp:latest\" }}\n    container_name: {{ .stack.name }}\n\n    {{ if has \"traefik\" .stacks.enabled }}\n    # Traefik integration\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.{{ .stack.name }}.rule=Host(`{{ .stack.name }}.{{ .vars.domain }}`)\"\n      - \"traefik.http.routers.{{ .stack.name }}.entrypoints=websecure\"\n      - \"traefik.http.routers.{{ .stack.name }}.tls.certresolver=letsencrypt\"\n      {{ if has \"authentik\" .stacks.enabled }}\n      - \"traefik.http.routers.{{ .stack.name }}.middlewares=authentik@file\"\n      {{ end }}\n    {{ else }}\n    # Direct port mapping\n    ports:\n      - \"{{ .vars.myapp.port | default \"8080\" }}:8080\"\n    {{ end }}\n\n    environment:\n      - TZ={{ .vars.timezone | default \"UTC\" }}\n      - LOG_LEVEL={{ .vars.myapp.log_level | default \"info\" }}\n      {{ if has \"authentik\" .stacks.enabled }}\n      - OAUTH_ENABLED=true\n      - OAUTH_ISSUER=https://auth.{{ .vars.domain }}\n      {{ end }}\n\n    volumes:\n      - {{ .vars.data_root | default \"/mnt/data\" }}/{{ .stack.name }}:/data\n      - {{ .vars.config_root | default \"/mnt/config\" }}/{{ .stack.name }}:/config\n\n    restart: unless-stopped\n\n    logging:\n      driver: json-file\n      options:\n        max-size: \"10m\"\n        max-file: \"3\"\n        tag: \"{{ .stack.category }}/{{ .stack.name }}\"\n\nvolumes:\n  {{ .stack.name }}_data:\n</code></pre>"},{"location":"reference/template-context/#context-data","title":"Context Data","text":"<pre><code>vars:\n  domain: example.com\n  timezone: America/New_York\n  data_root: /mnt/storage/data\n  config_root: /mnt/storage/config\n  myapp:\n    image: myapp:v1.2.3\n    port: 8080\n    log_level: debug\n\nstack:\n  name: myapp\n  category: tools\n\nstacks:\n  enabled:\n    - traefik\n    - authentik\n    - myapp\n</code></pre>"},{"location":"reference/template-context/#generated-output","title":"Generated Output","text":"<pre><code>services:\n  myapp:\n    image: myapp:v1.2.3\n    container_name: myapp\n\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.myapp.rule=Host(`myapp.example.com`)\"\n      - \"traefik.http.routers.myapp.entrypoints=websecure\"\n      - \"traefik.http.routers.myapp.tls.certresolver=letsencrypt\"\n      - \"traefik.http.routers.myapp.middlewares=authentik@file\"\n\n    environment:\n      - TZ=America/New_York\n      - LOG_LEVEL=debug\n      - OAUTH_ENABLED=true\n      - OAUTH_ISSUER=https://auth.example.com\n\n    volumes:\n      - /mnt/storage/data/myapp:/data\n      - /mnt/storage/config/myapp:/config\n\n    restart: unless-stopped\n\n    logging:\n      driver: json-file\n      options:\n        max-size: \"10m\"\n        max-file: \"3\"\n        tag: \"tools/myapp\"\n\nvolumes:\n  myapp_data:\n</code></pre>"},{"location":"reference/template-context/#variable-precedence-example","title":"Variable Precedence Example","text":"<p>Given:</p> <pre><code># stacks/myapp/stack.yaml\nvars:\n  myapp:\n    image: myapp:latest\n    port: 8080\n    debug: false\n\n# inventory/vars.yaml\nvars:\n  myapp:\n    port: 9000\n    replicas: 2\n\n# secrets/myapp.enc.yaml\nvars:\n  myapp:\n    debug: true\n    api_key: secret123\n</code></pre> <p>Context contains:</p> <pre><code>vars:\n  myapp:\n    image: myapp:latest      # From stack.yaml\n    port: 9000               # From inventory (overrides stack)\n    debug: true              # From secrets (overrides stack)\n    replicas: 2              # From inventory\n    api_key: secret123       # From secrets\n</code></pre>"},{"location":"reference/template-context/#best-practices","title":"Best Practices","text":""},{"location":"reference/template-context/#1-always-provide-defaults","title":"1. Always Provide Defaults","text":"<pre><code># Good\nimage: {{ .vars.myapp.image | default \"nginx:latest\" }}\nport: {{ .vars.myapp.port | default \"8080\" }}\n\n# Bad - fails if not defined\nimage: {{ .vars.myapp.image }}\n</code></pre>"},{"location":"reference/template-context/#2-use-consistent-variable-naming","title":"2. Use Consistent Variable Naming","text":"<pre><code># Good - hierarchical structure\nvars:\n  myapp:\n    server:\n      port: 8080\n    database:\n      host: postgres\n\n# Bad - flat structure\nvars:\n  myapp_server_port: 8080\n  myapp_database_host: postgres\n</code></pre>"},{"location":"reference/template-context/#3-check-stack-dependencies","title":"3. Check Stack Dependencies","text":"<pre><code># Good - verify dependency exists\n{{ if has \"postgres\" .stacks.enabled }}\ndepends_on:\n  - postgres\n{{ end }}\n\n# Bad - assume dependency exists\ndepends_on:\n  - postgres  # Fails if not enabled\n</code></pre>"},{"location":"reference/template-context/#4-document-variables","title":"4. Document Variables","text":"<pre><code># In stack.yaml - comment variable purpose\nvars:\n  myapp:\n    # Container image tag (default: latest)\n    image: myapp:latest\n\n    # HTTP port (1024-65535)\n    port: 8080\n\n    # Enable debug logging (true/false)\n    debug: false\n</code></pre>"},{"location":"reference/template-context/#see-also","title":"See Also","text":"<ul> <li>Variables &amp; Templating - Variable system overview</li> <li>Stack Structure - Stack organization</li> <li>Gomplate Documentation - Template function reference</li> </ul>"}]}